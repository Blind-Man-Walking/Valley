-- ===================================================================
-- 1. LOAD SERVICES & GLOBALS (FOR BOTH SCRIPTS)
-- ===================================================================
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local Stats = game:GetService("Stats")
local ProximityPromptService = game:GetService("ProximityPromptService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local Debris = game:GetService("Debris")
local HttpService = game:GetService("HttpService") -- For PC Script
local PlayerGui = game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui") -- For PC Script

-- Check if HttpService is enabled (for saving/loading)
local HttpService_Success = pcall(function() 
    HttpService:JSONEncode({key = "value"}) 
end)

-- Globals
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local Drawing = Drawing -- Check for the Drawing library

if not Drawing then
    warn("BlindHub Warning: 'Drawing' library not found. Box ESP, Tracers, and FOV Circle will not function.")
end

-- ===================================================================
-- 2. LOAD MOBILE UI LIBRARY (BlindHubsUiLibrary)
-- ===================================================================
-- This library is required for the Mobile Hub AND the Welcome Screen
local BlindHubsUiLibrary
do
    -- Using your new URL
    local success_get, source = pcall(game.HttpGet, game, "https://raw.githubusercontent.com/Blind-Man-Walking/Mobile-ui-/refs/heads/main/Mobile%20ui")
    if not success_get or not source then
        warn("BlindHub Error: Failed to HTTP-GET the UI Library. Network or URL may be down. Error: " .. tostring(source or "Unknown"))
        return
    end

    local success_load, chunk = pcall(loadstring, source)
    if not success_load or not chunk then
        warn("BlindHub Error: Failed to compile the UI Library (loadstring failed). The source code may be invalid. Error: " .. tostring(chunk or "Unknown"))
        return
    end

    local success_run, result = pcall(chunk)
    if not success_run or not result then
        warn("BlindHub Error: The UI Library was compiled but failed to run. Error: " .. tostring(result or "Unknown"))
        return
    end

    BlindHubsUiLibrary = result -- This is the successfully loaded library
end

-- Forward declarations for functions
local InitializeMainHub
local InitializePC_Hub
local CreateWelcomeScreen

-- ===================================================================
-- 3. DEFINE PC HUB FUNCTION (Loads PC Script)
-- ===================================================================
function InitializePC_Hub()
    print("BlindHub: Initializing PC UI...")
    
    -- NOTE: Services (Players, HttpService, etc.) are already loaded in the global scope

    -- ===================================================================
    -- ### 2. LOAD PC UI LIBRARY (_G.Library)
    -- ===================================================================

    -- Run the loader script
    loadstring(game:HttpGet("https://github.com/Blind-Man-Walking/Mobile/releases/latest/download/Pc.ui.txt"))()

    -- Wait for the library to finish loading
    print("Waiting for _G.Library...")
    repeat
        RunService.Heartbeat:Wait()
    until _G.Library
    print("Library found!")

    -- Get the library from the global variable
    local Library = _G.Library

    -- ===================================================================
    -- ### 3. DEFINE PC SETTINGS & FEATURE VARIABLES
    -- ===================================================================

    -- Default settings for the Settings tab
    local defaultSettings = {
        AutoFarm = false, InfiniteJump = false, ESP = true, GodMode = false,
        Noclip = false, InfiniteStamina = true, AutoRob = false, AutoPickup = true,
        SelectPart = "Head", SelectPlayer = "Select...", Walkspeed = "16",
        Chams = 0, WallhackOpacity = 50, SkyColorRed = 100, SkyColorGreen = 100,
        SkyColorBlue = 100, Brightness = 1, Theme = "Blue (Default)",
        ToggleKey = Enum.KeyCode.RightShift, WatermarkTransparency = 20,
        WatermarkFontSize = 16, WatermarkX = 100, WatermarkY = 0
    }
    local currentSettings = table.clone(defaultSettings)

    -- This table holds all the UI elements (buttons, sliders, etc.)
    local allUIElements = {}

    -- Teleport Locations
    local allTeleportLocations = {
        Outside = {
            -- [UPDATED CFRAME FOR PC]
            {Name="Criminal Base", CFrame=CFrame.new(739.997009, 1.1043756, -441.081299, 0.350970954, 4.13434798e-08, 0.936386347, -2.91054416e-08, 1, -3.32430226e-08, -0.936386347, -1.55866022e-08, 0.350970954)},
            {Name="Gas Station", CFrame=CFrame.new(308.1, 5.3, -611.0)},
            {Name="Barn", CFrame=CFrame.new(33.5912628, 10.0311041, 395.669403, 0.21937415, -2.87638127e-08, -0.975640833, 1.04137676e-07, 1, -6.06647443e-09, 0.975640833, -1.00270135e-07, 0.21937415)}
        },
        Prison = {
            {Name="Yard", CFrame=CFrame.new(59.2, 10.1, -136.7)},
            {Name="Security Room", CFrame=CFrame.new(224.2, 23.0, -157.0)},
            {Name="Cafeteria", CFrame=CFrame.new(66.7, 11.2, 31.7)},
            {Name="Checkpoint", CFrame=CFrame.new(-4.5, 22.1, -24.9)},
            {Name="Med Bay", CFrame=CFrame.new(137.3, 11.2, -162.5)},
            {Name="Directors Office", CFrame=CFrame.new(120.523872, 23.0880585, -101.480034, -0.996506214, -7.14903803e-10, -0.0835184902, -1.22781407e-09, 1, 6.08991524e-09, 0.0835184902, 6.17118356e-09, -0.996506214)},
            {Name="Gym", CFrame=CFrame.new(30.7318707, 22.1708984, -1.58649516, -0.534740806, -9.38145206e-09, 0.845016122, 1.5259138e-08, 1, 2.07583444e-08, -0.845016122, 2.39945521e-08, -0.534740806)},
            {Name="Library", CFrame=CFrame.new(-30.1708336, 11.2254019, 3.59955359, 0.973081648, -1.8039751e-08, -0.230460614, 3.96898585e-08, 1, 8.93068943e-08, 0.230460614, -9.60498454e-08, 0.973081648)},
            {Name="Vents", CFrame=CFrame.new(47.2205162, -8.8703413, -63.9462776, 0.053843759, 1.04880968e-07, -0.998549402, 5.04200663e-08, 1, 1.07752079e-07, 0.998549402, -5.61487035e-08, 0.053843759)}
        },
        Blocks = {
            {Name="Max Security", CFrame=CFrame.new(87.0, -8.8, -137.1)},
            {Name="Min/Med Security", CFrame=CFrame.new(-1.5, 11.2, -55.4)},
            {Name="Solitary", CFrame=CFrame.new(144.9, -8.8, -41.6)}
        }
    }

    -- Feature Variables
    local toggleStates = {
        Walkspeed = false, JumpPower = false, InfiniteJump = false, InfStamina = false,
        InfCamZoom = false, Invisicam = false, ThirdPerson = false, PlayerInfo = false,
        HighlightESP = false, BoxESP = false, Tracers = false, RapidFire = false,
        AccurateShots = false, ShowFOV = false, WallCheck = false, TeamCheck = false,
        AutoPickup = false, XRay = false, FullBrightness = false,
        UnlimitedWeaponDrop = true, AutoDropItems = false, FullAuto = false -- [NEW]
    }

    -- Player Feature Variables
    local player_WS_Value, player_JP_Value = 16, 14
    local originalWalkSpeed = 16
    local originalJumpPower = 50
    local originalMaxZoomDistance = LocalPlayer.CameraMaxZoomDistance or 128
    local originalDevCameraMode = LocalPlayer.DevCameraOcclusionMode or Enum.DevCameraOcclusionMode.Zoom
    local infJumpConnection
    local originalStaminaValue, originalMaxStaminaValue; local stamina, maxStamina
    pcall(function()
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
            originalWalkSpeed = LocalPlayer.Character.Humanoid.WalkSpeed
            originalJumpPower = LocalPlayer.Character.Humanoid.JumpPower
        end
        originalMaxZoomDistance = LocalPlayer.CameraMaxZoomDistance
        originalDevCameraMode = LocalPlayer.DevCameraOcclusionMode
        stamina = LocalPlayer:WaitForChild("ServerVariables", 5):WaitForChild("Sprint", 2):WaitForChild("Stamina", 2)
        maxStamina = LocalPlayer:WaitForChild("ServerVariables", 5):WaitForChild("Sprint", 2):WaitForChild("MaxStamina", 2)
    end)

    -- ESP Feature Variables & Helpers
    local PlayerInfoConfig = { Font = Enum.Font.SourceSansBold, TextSize = 15, Offset = Vector3.new(0, 3, 0) }
    local playerInfoCache, highlights, BoxESPObjects, tracerDrawings = {}, {}, {}, {}
    local infoPlayerAddedConn, infoPlayerRemovingConn, infoCharacterAddedConns = nil, nil, {}
    local highlightPlayerAddedConn, highlightPlayerRemovingConn, highlightCharacterAddedConns = nil, nil, {}
    local boxPlayerAddedConn, boxPlayerRemovingConn, tracerPlayerAddedConn, tracerPlayerRemovingConn
    local function cleanupPlayerInfo(player) if playerInfoCache[player] and playerInfoCache[player].billboard then pcall(function() playerInfoCache[player].billboard:Destroy() end) end; playerInfoCache[player] = nil end
    local function createPlayerInfo(player) if player == LocalPlayer then return end; cleanupPlayerInfo(player); local char = player.Character; if not char then return end; local head = char:WaitForChild("Head", 5); if not head then return end; local b = Instance.new('BillboardGui', head); b.Name, b.Adornee, b.Size, b.StudsOffset, b.AlwaysOnTop, b.LightInfluence = player.Name .. "-InfoESP", head, UDim2.new(0, 200, 0, 45), PlayerInfoConfig.Offset, true, 0; local t = Instance.new('TextLabel', b); t.Name, t.Size, t.BackgroundTransparency, t.TextStrokeTransparency, t.Font, t.TextSize = 'ESPLabel', UDim2.fromScale(1, 1), 1, 0.5, PlayerInfoConfig.Font, PlayerInfoConfig.TextSize; playerInfoCache[player] = { billboard = b, textLabel = t } end
    local function createHighlight(p) if highlights[p] or p == LocalPlayer or not p.Character then return end; local h = Instance.new('Highlight', p.Character); h.Name, h.FillTransparency, h.OutlineTransparency, h.DepthMode, h.Adornee = "BH_Highlight", 0.5, 0.5, Enum.HighlightDepthMode.AlwaysOnTop, p.Character; highlights[p] = h end
    local function removeHighlight(p) if highlights[p] then pcall(function() highlights[p]:Destroy() end); highlights[p] = nil end end
    local function NewQuad(thickness, color) if not Drawing then return nil end; local q = Drawing.new('Quad'); q.Visible, q.PointA, q.PointB, q.PointC, q.PointD, q.Color, q.Filled, q.Thickness = false, Vector2.new(), Vector2.new(), Vector2.new(), Vector2.new(), color, false, thickness; return q end
    local function BoxVis(shouldShow, listOfDrawings) if not listOfDrawings then return end; for _, obj in pairs(listOfDrawings) do if obj then obj.Visible = shouldShow end end end
    local function teardownBox(player) if BoxESPObjects[player] then for _, d in pairs(BoxESPObjects[player]) do if d then pcall(function() d:Destroy() end) end end; BoxESPObjects[player] = nil end end
    local function CreateBoxESP(p) if BoxESPObjects[p] or p == LocalPlayer then return end; local quad_black, quad_box = NewQuad(2, Color3.new()), NewQuad(1, p.TeamColor.Color); if not quad_black or not quad_box then return end; BoxESPObjects[p] = {black = quad_black, box = quad_box} end
    local function setupTracer(p) if toggleStates.Tracers and not tracerDrawings[p] and p.Character and p ~= LocalPlayer and Drawing then local t = Drawing.new('Line'); t.Visible, t.Thickness = false, 1; tracerDrawings[p] = t end end
    local function teardownTracer(p) if tracerDrawings[p] then pcall(function() tracerDrawings[p]:Destroy() end); tracerDrawings[p] = nil end end

    -- Aimbot Feature Variables & Helpers
    local aimbotMaxDistance, fovCircleRadius, aimbotStrength = 500, 150, 1.0
    local aimbotTarget, fovCircleDrawing = nil, nil
    local originalRPMs, originalAccuracies, originalFiremodes = {}, {}, {} -- [NEW]
    
    -- [NEW] Helper function for Full Auto
    local function SetFiremode(tool, enabled)
        if not tool or not tool:IsA("Tool") then return end
        
        local firemodeValue = tool:FindFirstChild("Variables", true)
        if firemodeValue then
            firemodeValue = firemodeValue:FindFirstChild("CurFiremode")
        end
        
        if firemodeValue and firemodeValue:IsA("StringValue") then
            if enabled then
                if not originalFiremodes[tool] then
                    originalFiremodes[tool] = firemodeValue.Value -- Save original
                end
                firemodeValue.Value = "Auto"
            else
                if originalFiremodes[tool] then
                    firemodeValue.Value = originalFiremodes[tool] -- Restore original
                    originalFiremodes[tool] = nil -- Clear cache
                end
            end
        end
    end
    
    local function isTargetHostile(targetPlayer) if not targetPlayer then return false end; local safeItems = { ["taco"] = true, ["donut"] = true, ["chocolate milk"] = true, ["hot chocolate"] = true, ["sandwich"] = true, ["turkeyleg"] = true, ["food tray"] = true, ["weights"] = true, ["nachos"] = true, ["bloxycola"] = true, ["pizza"] = true, ["cheezburger"] = true, ["sign"] = true, ["book"] = true }; local allToolsToCheck = {}; local character = targetPlayer.Character; if character then local equippedTool = character:FindFirstChildOfClass("Tool"); if equippedTool then table.insert(allToolsToCheck, equippedTool) end end; local backpack = targetPlayer:FindFirstChildOfClass("Backpack"); if backpack then for _, item in ipairs(backpack:GetChildren()) do if item:IsA("Tool") then table.insert(allToolsToCheck, item) end end end; if #allToolsToCheck == 0 then return false end; for _, tool in ipairs(allToolsToCheck) do local toolName = tool.Name:lower(); if not safeItems[toolName] then return true end end; return false end
    local function SetWeaponValue(tool, propertyName, enabled, value, originalValuesTable) if not tool then return end; local valueObject = tool:FindFirstChild("LocalConfig", true); if valueObject then valueObject = valueObject:FindFirstChild("Configuration", true) end; if valueObject then valueObject = valueObject:FindFirstChild(propertyName, true) end; if valueObject and valueObject:IsA("ValueBase") then if enabled then if not originalValuesTable[tool] then originalValuesTable[tool] = valueObject.Value end; valueObject.Value = value else if originalValuesTable[tool] then valueObject.Value = originalValuesTable[tool]; originalValuesTable[tool] = nil end end end end
    
    -- [MODIFIED] This now handles all weapon mods
    local function HandleCharacter(character) 
        character.ChildAdded:Connect(function(child) 
            if child:IsA("Tool") then 
                task.wait(0.1); 
                SetFiremode(child, toggleStates.FullAuto) -- [NEW]
                if toggleStates.RapidFire then SetWeaponValue(child, "RPM", true, math.huge, originalRPMs) end; 
                if toggleStates.AccurateShots then SetWeaponValue(child, "Accuracy", true, Vector3.new(0, 0, 0), originalAccuracies) end 
            end 
        end); 
        character.ChildRemoved:Connect(function(child) 
            if child:IsA("Tool") then 
                SetFiremode(child, false) -- [NEW]
                SetWeaponValue(child, "RPM", false, nil, originalRPMs); 
                SetWeaponValue(child, "Accuracy", false, nil, originalAccuracies) 
            end 
        end); 
        local currentTool = character:FindFirstChildOfClass("Tool"); 
        if currentTool then 
            SetFiremode(currentTool, toggleStates.FullAuto) -- [NEW]
            if toggleStates.RapidFire then SetWeaponValue(currentTool, "RPM", true, math.huge, originalRPMs) end; 
            if toggleStates.AccurateShots then SetWeaponValue(currentTool, "Accuracy", true, Vector3.new(0, 0, 0), originalAccuracies) end 
        end 
    end

    -- Misc Feature Variables
    local xrayDescendantConn, originalLightingProps, dropWeaponsConnection = nil, nil, nil

    -- ===================================================================
    -- ### 4. CREATE THE PC WINDOW
    -- ===================================================================
    local mainScreenGui, rectangle, tabContainer, contentContainer, titleLabel, subtitleLabel, toggleGui, setUIVisible = Library.createWindow("BlindHubOfficial", "discord.gg/BlindHub")
    print("PC Window created!")

    -- ===================================================================
    -- ### 5. CREATE THE PC TABS
    -- ===================================================================
    local mainPage, mainTabButton = Library.createTab("Main", tabContainer, contentContainer)
    local combatPage, combatTabButton = Library.createTab("Combat", tabContainer, contentContainer)
    local miscPage, miscTabButton = Library.createTab("Misc", tabContainer, contentContainer)
    local settingsPage, settingsTabButton = Library.createTab("Settings", tabContainer, contentContainer)
    print("PC Tabs created!")

    -- ===================================================================
    -- ### 6. POPULATE PC "MAIN" TAB
    -- ===================================================================
    local getWSS, wsChanged, setWSS, getJPS, jpChanged, setJPS
    local playerSection, playerContent = Library.createBigSection(mainPage, "Player Features", Library.Positions.Big)
    Library.createDivider(playerContent)
    local walkspeedToggleBtn = Library.createToggleButton(playerContent, "Walkspeed", toggleStates.Walkspeed)
    walkspeedToggleBtn.MouseButton1Click:Connect(function() toggleStates.Walkspeed = not toggleStates.Walkspeed; if not toggleStates.Walkspeed and LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then LocalPlayer.Character.Humanoid.WalkSpeed = originalWalkSpeed end end)
    local jumpPowerToggleBtn = Library.createToggleButton(playerContent, "JumpPower", toggleStates.JumpPower)
    jumpPowerToggleBtn.MouseButton1Click:Connect(function() toggleStates.JumpPower = not toggleStates.JumpPower; if not toggleStates.JumpPower and LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then LocalPlayer.Character.Humanoid.JumpPower = originalJumpPower end end)
    Library.createDivider(playerContent)
    local infJumpToggleBtn = Library.createToggleButton(playerContent, "Infinite Jump", toggleStates.InfiniteJump)
    infJumpToggleBtn.MouseButton1Click:Connect(function() toggleStates.InfiniteJump = not toggleStates.InfiniteJump; if infJumpConnection then infJumpConnection:Disconnect() end; if toggleStates.InfiniteJump then infJumpConnection = UserInputService.JumpRequest:Connect(function() if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then LocalPlayer.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping) end end) end end)
    local infStaminaToggleBtn = Library.createToggleButton(playerContent, "Inf Stamina", toggleStates.InfStamina)
    infStaminaToggleBtn.MouseButton1Click:Connect(function() toggleStates.InfStamina = not toggleStates.InfStamina; if not stamina or not maxStamina then Library.createNotification("Error", "Stamina variables not found.", 5); toggleStates.InfStamina = false; return end; if toggleStates.InfStamina then if originalStaminaValue == nil then originalStaminaValue = stamina.Value end; if originalMaxStaminaValue == nil then originalMaxStaminaValue = maxStamina.Value end; stamina.Value, maxStamina.Value = math.huge, math.huge else if originalStaminaValue ~= nil then stamina.Value = originalStaminaValue end; if originalMaxStaminaValue ~= nil then maxStamina.Value = originalMaxStaminaValue end end end)
    local infCamZoomToggleBtn = Library.createToggleButton(playerContent, "Inf cam zoom", toggleStates.InfCamZoom)
    infCamZoomToggleBtn.MouseButton1Click:Connect(function() toggleStates.InfCamZoom = not toggleStates.InfCamZoom; LocalPlayer.CameraMaxZoomDistance = toggleStates.InfCamZoom and 100000 or originalMaxZoomDistance end)
    Library.createDivider(playerContent)
    local invisicamToggleBtn = Library.createToggleButton(playerContent, "invisible cam", toggleStates.Invisicam)
    invisicamToggleBtn.MouseButton1Click:Connect(function() toggleStates.Invisicam = not toggleStates.Invisicam; LocalPlayer.DevCameraOcclusionMode = toggleStates.Invisicam and Enum.DevCameraOcclusionMode.Invisicam or originalDevCameraMode end)
    local thirdPersonToggleBtn = Library.createToggleButton(playerContent, "Third Person (Mobile)", toggleStates.ThirdPerson)
    thirdPersonToggleBtn.MouseButton1Click:Connect(function() toggleStates.ThirdPerson = not toggleStates.ThirdPerson; if toggleStates.ThirdPerson then if LocalPlayer.CameraMode == Enum.CameraMode.LockFirstPerson then LocalPlayer.CameraMode = Enum.CameraMode.Classic; Library.createNotification("Camera", "Forced Third Person", 1.5) end else local char = LocalPlayer.Character; local hum = char and char:FindFirstChildOfClass("Humanoid"); if hum and char then local tool = char:FindFirstChildOfClass("Tool"); if tool then LocalPlayer.CameraMode = Enum.CameraMode.LockFirstPerson; Library.createNotification("Camera", "Restored First Person", 1.5) end end end end)
    LocalPlayer:GetPropertyChangedSignal("CameraMode"):Connect(function() if toggleStates.ThirdPerson and LocalPlayer.CameraMode == Enum.CameraMode.LockFirstPerson then LocalPlayer.CameraMode = Enum.CameraMode.Classic end end)
    Library.createDivider(playerContent)
    local tpCardBtn = Library.createButton(playerContent, "Tp to Card"); tpCardBtn.MouseButton1Click:Connect(function() local map = Workspace:FindFirstChild("Map"); if not map then return Library.createNotification("Error", "This feature is game-specific.", 4) end; if type(fireproximityprompt) ~= "function" then return Library.createNotification("Error", "fireproximityprompt not supported.", 4) end; local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart"); if not hrp then return Library.createNotification("Error", "Character not found.", 3) end; local keycardsFolder = map:FindFirstChild("Keycards"); if not keycardsFolder then return Library.createNotification("Error", "Keycards folder not found.", 3) end; for _, cardModel in ipairs(keycardsFolder:GetChildren()) do local prompt = cardModel:FindFirstChildOfClass("ProximityPrompt", true); if prompt and prompt.Enabled then hrp.CFrame = prompt.Parent.CFrame * CFrame.new(0, 3, 0); task.wait(0.2); fireproximityprompt(prompt); return Library.createNotification("Keycard", "Teleporting to " .. cardModel.Name, 3) end end; Library.createNotification("Keycard", "No available keycards found.", 4) end)
    local becomeCrimBtn = Library.createButton(playerContent, "Become Criminal"); becomeCrimBtn.MouseButton1Click:Connect(function() local map = Workspace:FindFirstChild("Map"); if not map then return Library.createNotification("Error", "This feature is game-specific.", 4) end; local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart"); if not hrp then return Library.createNotification("Error", "Character not found.", 3) end; local escapeBarriersFolder = map:FindFirstChild("Functional", true) and map.Functional:FindFirstChild("Invisible", true) and map.Functional.Invisible:FindFirstChild("EscapeBarriers", true); if escapeBarriersFolder then local barriers = escapeBarriersFolder:GetChildren(); if #barriers > 0 then local targetBarrier = barriers[math.min(10, #barriers)]; hrp.CFrame = targetBarrier.CFrame * CFrame.new(0, 3, 0); Library.createNotification("Criminal", "Teleported to escape point.", 3) else Library.createNotification("Error", "No escape barriers found.", 4) end else Library.createNotification("Error", "Could not find EscapeBarriers folder.", 4) end end)
    local tpSection, tpContent = Library.createSmallSection(mainPage, "Teleports", Library.Positions.SmallTop)
    for categoryName, locations in pairs(allTeleportLocations) do for _, loc in ipairs(locations) do local tpBtn = Library.createButton(tpContent, loc.Name); tpBtn.MouseButton1Click:Connect(function() local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart"); if hrp then hrp.CFrame = loc.CFrame; Library.createNotification("Teleport", "Teleported to " .. loc.Name, 3) else Library.createNotification("Error", "Character not found.", 3) end end) end; if categoryName ~= "Blocks" then Library.createDivider(tpContent) end end
    local sliderSection, sliderContent = Library.createSmallSection(mainPage, "Modifiers", Library.Positions.SmallBottom)
    local walkspeedSlider; walkspeedSlider, getWSS, wsChanged, setWSS = Library.createSlider(sliderContent, "Speed", 16, 900, 16, rectangle); walkspeedSlider.Visible = true; wsChanged:Connect(function(value) player_WS_Value = value end)
    local jumpPowerSlider; jumpPowerSlider, getJPS, jpChanged, setJPS = Library.createSlider(sliderContent, "Power", 14, 500, 14, rectangle); jumpPowerSlider.Visible = true; jpChanged:Connect(function(value) player_JP_Value = value end)
    print("PC Main tab content loaded!")

    -- ===================================================================
    -- ### 7. POPULATE PC "COMBAT" TAB
    -- ===================================================================
    local combatFeaturesSection, combatFeaturesContent = Library.createSmallSection(combatPage, "Combat Features", Library.Positions.SmallTop); combatFeaturesSection.Position = UDim2.new(0, 0, 0, 0)
    local rapidFireToggleBtn, accurateShotsToggleBtn, fullAutoToggleBtn, showFovToggleBtn, wallCheckToggleBtn, teamCheckToggleBtn, fovRadiusSlider, aimbotDistanceSlider, aimbotStrengthSlider -- [MODIFIED]
    rapidFireToggleBtn = Library.createToggleButton(combatFeaturesContent, "Rapid Fire", toggleStates.RapidFire); 
    accurateShotsToggleBtn = Library.createToggleButton(combatFeaturesContent, "Accurate Shots", toggleStates.AccurateShots); 
    fullAutoToggleBtn = Library.createToggleButton(combatFeaturesContent, "Full Auto", toggleStates.FullAuto); -- [NEW]
    showFovToggleBtn = Library.createToggleButton(combatFeaturesContent, "Show FOV Circle", toggleStates.ShowFOV); 
    wallCheckToggleBtn = Library.createToggleButton(combatFeaturesContent, "Wall Check", toggleStates.WallCheck); 
    teamCheckToggleBtn = Library.createToggleButton(combatFeaturesContent, "Team Check", toggleStates.TeamCheck); 
    Library.createDivider(combatFeaturesContent)
    
    rapidFireToggleBtn.MouseButton1Click:Connect(function() toggleStates.RapidFire = not toggleStates.RapidFire; if LocalPlayer.Character then HandleCharacter(LocalPlayer.Character) end end)
    accurateShotsToggleBtn.MouseButton1Click:Connect(function() toggleStates.AccurateShots = not toggleStates.AccurateShots; if LocalPlayer.Character then HandleCharacter(LocalPlayer.Character) end end)
    
    -- [NEW]
    fullAutoToggleBtn.MouseButton1Click:Connect(function() 
        toggleStates.FullAuto = not toggleStates.FullAuto
        if LocalPlayer.Character then 
            HandleCharacter(LocalPlayer.Character) 
        end 
    end)
    
    showFovToggleBtn.MouseButton1Click:Connect(function() toggleStates.ShowFOV = not toggleStates.ShowFOV; if toggleStates.ShowFOV and not fovCircleDrawing and Drawing then fovCircleDrawing = Drawing.new("Circle"); fovCircleDrawing.Thickness = 1; fovCircleDrawing.NumSides = 64; fovCircleDrawing.Color = Color3.new(1, 1, 1); fovCircleDrawing.Filled = false; fovCircleDrawing.Radius = fovCircleRadius; fovCircleDrawing.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2) end; if fovCircleDrawing then fovCircleDrawing.Visible = toggleStates.ShowFOV end end)
    wallCheckToggleBtn.MouseButton1Click:Connect(function() toggleStates.WallCheck = not toggleStates.WallCheck end); teamCheckToggleBtn.MouseButton1Click:Connect(function() toggleStates.TeamCheck = not toggleStates.TeamCheck end)
    if LocalPlayer.Character then HandleCharacter(LocalPlayer.Character) end; LocalPlayer.CharacterAdded:Connect(HandleCharacter)
    local espSection, espContent = Library.createSmallSection(combatPage, "Esp", Library.Positions.SmallTop); espSection.Position = UDim2.new(0.5, 5, 0, 0)
    local infoToggleBtn = Library.createToggleButton(espContent, "Player Info", toggleStates.PlayerInfo); infoToggleBtn.MouseButton1Click:Connect(function() toggleStates.PlayerInfo = not toggleStates.PlayerInfo; local enabled = toggleStates.PlayerInfo; local function setupInfo(player) if player == LocalPlayer then return end; if infoCharacterAddedConns[player] then infoCharacterAddedConns[player]:Disconnect() end; if player.Character then createPlayerInfo(player) end; infoCharacterAddedConns[player] = player.CharacterAdded:Connect(function() task.wait(0.1); createPlayerInfo(player) end) end; local function teardownInfo(player) cleanupPlayerInfo(player); if infoCharacterAddedConns[player] then infoCharacterAddedConns[player]:Disconnect(); infoCharacterAddedConns[player] = nil end end; if enabled then infoPlayerAddedConn = Players.PlayerAdded:Connect(setupInfo); infoPlayerRemovingConn = Players.PlayerRemoving:Connect(teardownInfo); for _, p in ipairs(Players:GetPlayers()) do setupInfo(p) end else if infoPlayerAddedConn then infoPlayerAddedConn:Disconnect() end; if infoPlayerRemovingConn then infoPlayerRemovingConn:Disconnect() end; for _, p in ipairs(Players:GetPlayers()) do teardownInfo(p) end end end)
    local highlightToggleBtn = Library.createToggleButton(espContent, "Highlight ESP", toggleStates.HighlightESP); highlightToggleBtn.MouseButton1Click:Connect(function() toggleStates.HighlightESP = not toggleStates.HighlightESP; local enabled = toggleStates.HighlightESP; local function setupHighlight(player) if player == LocalPlayer then return end; if highlightCharacterAddedConns[player] then highlightCharacterAddedConns[player]:Disconnect() end; if player.Character then createHighlight(player) end; highlightCharacterAddedConns[player] = player.CharacterAdded:Connect(function() removeHighlight(player); task.wait(0.1); createHighlight(player) end) end; local function teardownHighlight(player) removeHighlight(player); if highlightCharacterAddedConns[player] then highlightCharacterAddedConns[player]:Disconnect(); highlightCharacterAddedConns[player] = nil end end; if enabled then highlightPlayerAddedConn = Players.PlayerAdded:Connect(setupHighlight); highlightPlayerRemovingConn = Players.PlayerRemoving:Connect(teardownHighlight); for _, p in ipairs(Players:GetPlayers()) do setupHighlight(p) end else if highlightPlayerAddedConn then highlightPlayerAddedConn:Disconnect() end; if highlightPlayerRemovingConn then highlightPlayerRemovingConn:Disconnect() end; for _, p in ipairs(Players:GetPlayers()) do teardownHighlight(p) end end end)
    local boxToggleBtn = Library.createToggleButton(espContent, "Box ESP", toggleStates.BoxESP); boxToggleBtn.MouseButton1Click:Connect(function() toggleStates.BoxESP = not toggleStates.BoxESP; local enabled = toggleStates.BoxESP; if enabled then boxPlayerAddedConn = Players.PlayerAdded:Connect(function(p) if p ~= LocalPlayer then CreateBoxESP(p) end end); boxPlayerRemovingConn = Players.PlayerRemoving:Connect(teardownBox); for _, p in pairs(Players:GetPlayers()) do if p ~= LocalPlayer then CreateBoxESP(p) end end else if boxPlayerAddedConn then boxPlayerAddedConn:Disconnect() end; if boxPlayerRemovingConn then boxPlayerRemovingConn:Disconnect() end; for p, _ in pairs(BoxESPObjects) do teardownBox(p) end end end)
    local tracersToggleBtn = Library.createToggleButton(espContent, "Tracers", toggleStates.TracLcers); tracersToggleBtn.MouseButton1Click:Connect(function() toggleStates.Tracers = not toggleStates.Tracers; local enabled = toggleStates.Tracers; if enabled then for _, p in pairs(Players:GetPlayers()) do setupTracer(p) end; tracerPlayerAddedConn = Players.PlayerAdded:Connect(setupTracer); tracerPlayerRemovingConn = Players.PlayerRemoving:Connect(teardownTracer) else if tracerPlayerAddedConn then tracerPlayerAddedConn:Disconnect() end; if tracerPlayerRemovingConn then tracerPlayerRemovingConn:Disconnect() end; for p, t in pairs(tracerDrawings) do if t then pcall(function() t:Destroy() end) end end; tracerDrawings = {} end end)
    local combatSliderSection, combatSliderContent = Library.createSmallSection(combatPage, "Combat Sliders", Library.Positions.SmallBottom); combatSliderSection.Position = UDim2.new(0.5, 5, 0.5, 5)
    local fovR_slider, fovR_get, fovR_changed, fovR_set = Library.createSlider(combatSliderContent, "FOV Radius", 50, 500, 150, rectangle); fovRadiusSlider = fovR_slider; local dist_slider, dist_get, dist_changed, dist_set = Library.createSlider(combatSliderContent, "Max Distance", 50, 1500, 500, rectangle); aimbotDistanceSlider = dist_slider; local str_slider, str_get, str_changed, str_set = Library.createSlider(combatSliderContent, "Aimbot Strength", 0, 1000, 100, rectangle); aimbotStrengthSlider = str_slider
    fovR_changed:Connect(function(value) fovCircleRadius = value; if fovCircleDrawing then fovCircleDrawing.Radius = value end end); dist_changed:Connect(function(value) aimbotMaxDistance = value end); str_changed:Connect(function(value) aimbotStrength = value / 1000 end)
    print("PC Combat tab content loaded!")

    -- ===================================================================
    -- ### 8. POPULATE PC "MISC" TAB
    -- ===================================================================
    local miscSectionLeft, miscContentLeft = Library.createBigSection(miscPage, "Misc Features", Library.Positions.Big)
    Library.createDivider(miscContentLeft); local removeDoorsBtn = Library.createButton(miscContentLeft, "Remove Doors"); removeDoorsBtn.MouseButton1Click:Connect(function() local map = Workspace:FindFirstChild("Map"); if not map or not map:FindFirstChild("Functional") then return Library.createNotification("Error", "Could not find 'Map.Functional' folder.", 3) end; local doorsFolder = map.Functional:FindFirstChild("Doors"); if doorsFolder then pcall(function() doorsFolder:Destroy() end); Library.createNotification("Misc", "Doors removed.", 3) else Library.createNotification("Error", "Could not find doors folder.", 3) end end)
    local removeVentsBtn = Library.createButton(miscContentLeft, "Remove Vents"); removeVentsBtn.MouseButton1Click:Connect(function() local map = Workspace:FindFirstChild("Map"); if not map or not map:FindFirstChild("Functional") then return Library.createNotification("Error", "Could not find 'Map.Functional' folder.", 3) end; local ventsFolder = map.Functional:FindFirstChild("Vents"); if ventsFolder then pcall(function() ventsFolder:Destroy() end); Library.createNotification("Misc", "Vents removed.", 3) else Library.createNotification("Error", "Could not find vents folder.", 3) end end)
    local removeSpawnKillBtn = Library.createButton(miscContentLeft, "Remove Spawnkill Barrier"); removeSpawnKillBtn.MouseButton1Click:Connect(function() local map = Workspace:FindFirstChild("Map"); if not map or not map:FindFirstChild("Functional") or not map.Functional:FindFirstChild("Invisible") then return Library.createNotification("Error", "Could not find 'Map.Functional.Invisible' folder.", 3) end; local barriersFolder = map.Functional.Invisible:FindFirstChild("SpawnkillBarriers"); if barriersFolder then pcall(function() barriersFolder:Destroy() end); Library.createNotification("Misc", "Spawnkill barriers removed.", 3) else Library.createNotification("Error", "Could not find spawnkill barriers.", 3) end end)
    local removeRoofKillBtn = Library.createButton(miscContentLeft, "Remove Roof Kill"); removeRoofKillBtn.MouseButton1Click:Connect(function() local map = Workspace:FindFirstChild("Map"); if not map or not map:FindFirstChild("Functional") or not map.Functional:FindFirstChild("Invisible") then return Library.createNotification("Error", "Could not find 'Map.Functional.Invisible' folder.", 3) end; local brickKill = map.Functional.Invisible:FindFirstChild("Brickkill"); if brickKill then pcall(function() brickKill:Destroy() end); Library.createNotification("Misc", "Roof kill part removed.", 3) else Library.createNotification("Error", "Could not find 'Brickkill' part.", 3) end end)
    Library.createDivider(miscContentLeft); local autoPickupToggleBtn = Library.createToggleButton(miscContentLeft, "Auto-Pickup Dropped Tools", toggleStates.AutoPickup); autoPickupToggleBtn.MouseButton1Click:Connect(function() toggleStates.AutoPickup = not toggleStates.AutoPickup; if not toggleStates.AutoPickup then return end; if type(fireclickdetector) ~= "function" and typeof(fireclickdetector) ~= "function" then Library.createNotification("Error", "'fireclickdetector' not available.", 5); toggleStates.AutoPickup = false; return end; task.spawn(function() Library.createNotification("Automation", "Auto-pickup enabled.", 3); while toggleStates.AutoPickup do task.wait(); local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart"); local droppedToolsFolder = Workspace:FindFirstChild("DroppedTools"); if hrp and droppedToolsFolder and #droppedToolsFolder:GetChildren() > 0 then local closestTool, minDistance = nil, math.huge; for _, tool in ipairs(droppedToolsFolder:GetChildren()) do local part = tool.PrimaryPart or tool:FindFirstChild("Handle") or tool:FindFirstChild("MainAttach"); if part then local distance = (hrp.Position - part.Position).Magnitude; if distance < minDistance then minDistance, closestTool = distance, tool end end end; if closestTool then local containerPart = closestTool:FindFirstChild("Handle") or closestTool:FindFirstChild("MainAttach"); if containerPart then hrp.CFrame = containerPart.CFrame * CFrame.new(0, 3, 0); task.wait(0.5); local clickDetector = containerPart:FindFirstChildOfClass("ClickDetector"); if clickDetector then fireclickdetector(clickDetector); task.wait(0.5) end end end else task.wait(1) end end end) end)
    Library.createDivider(miscContentLeft); local xrayToggleBtn = Library.createToggleButton(miscContentLeft, "X-Ray", toggleStates.XRay); local function setXray(enabled) if enabled then for _, v in ipairs(Workspace:GetDescendants()) do if v:IsA("BasePart") and not v:IsDescendantOf(LocalPlayer.Character) then v.LocalTransparencyModifier = 0.75 end end; xrayDescendantConn = Workspace.DescendantAdded:Connect(function(v) if v:IsA("BasePart") and not v:IsDescendantOf(LocalPlayer.Character) then v.LocalTransparencyModifier = 0.75 end end) else if xrayDescendantConn then xrayDescendantConn:Disconnect(); xrayDescendantConn = nil end; for _, v in ipairs(Workspace:GetDescendants()) do if v:IsA("BasePart") then v.LocalTransparencyModifier = 0 end end end end; xrayToggleBtn.MouseButton1Click:Connect(function() toggleStates.XRay = not toggleStates.XRay; setXray(toggleStates.XRay) end)
    local brightnessToggleBtn = Library.createToggleButton(miscContentLeft, "Full Brightness", toggleStates.FullBrightness); brightnessToggleBtn.MouseButton1Click:Connect(function() toggleStates.FullBrightness = not toggleStates.FullBrightness; local value = toggleStates.FullBrightness; if value then if not originalLightingProps then originalLightingProps = {Ambient=Lighting.Ambient, OutdoorAmbient=Lighting.OutdoorAmbient, Brightness=Lighting.Brightness, GlobalShadows=Lighting.GlobalShadows} end; pcall(function() Lighting.Ambient = Color3.fromRGB(180,180,180); Lighting.OutdoorAmbient = Color3.fromRGB(180,180,180); Lighting.Brightness = 1.5; Lighting.GlobalShadows = false end) else if originalLightingProps then pcall(function() Lighting.Ambient = originalLightingProps.Ambient; Lighting.OutdoorAmbient = originalLightingProps.OutdoorAmbient; Lighting.Brightness = originalLightingProps.Brightness; Lighting.GlobalShadows = originalLightingProps.GlobalShadows end) end end end)
    local miscSectionRight, miscContentRight = Library.createSmallSection(miscPage, "Item Dropper", Library.Positions.SmallTop)
    local function DropWeapon(tool) local Character = LocalPlayer.Character; if not tool:IsA("Tool") or not tool:FindFirstChild("DropServer") or not Character then return end; tool.Parent = Character; if tool:FindFirstChild("Handle") then tool.Handle.Position = Character.HumanoidRootPart.Position; task.wait(0.025) end; if tool:FindFirstChild("DropServer") then local keyEvent = tool.DropServer:FindFirstChild("KeySend"); if keyEvent then keyEvent:FireServer() end end end
    local function DropAllWeapons() local Character = LocalPlayer.Character; if not Character then return end; for _, item in pairs(Character:GetChildren()) do if item:IsA("Tool") then item.Parent = LocalPlayer.Backpack end end; task.wait(0.1); for _, tool in pairs(LocalPlayer.Backpack:GetChildren()) do if tool:FindFirstChild("DropServer") then DropWeapon(tool); task.wait(0.05) end end end
    local function OnCharacterDied() if toggleStates.UnlimitedWeaponDrop then DropAllWeapons() end end
    local function OnCharacterAdded(newCharacter) local humanoid = newCharacter:WaitForChild("Humanoid"); if dropWeaponsConnection then dropWeaponsConnection:Disconnect() end; dropWeaponsConnection = humanoid.Died:Connect(OnCharacterDied) end
    if LocalPlayer.Character then OnCharacterAdded(LocalPlayer.Character) end; LocalPlayer.CharacterAdded:Connect(OnCharacterAdded)
    local unlimitedDropToggle = Library.createToggleButton(miscContentRight, "Drop All Weapons on Death", toggleStates.UnlimitedWeaponDrop); unlimitedDropToggle.MouseButton1Click:Connect(function() toggleStates.UnlimitedWeaponDrop = not toggleStates.UnlimitedWeaponDrop; if toggleStates.UnlimitedWeaponDrop then Library.createNotification("Misc", "Unlimited Weapon Drop enabled.", 3) else Library.createNotification("Misc", "Unlimited Weapon Drop disabled.", 3) end end)
    Library.createDivider(miscContentRight); local playerDropdown, getSelectedPlayer, updatePlayerDropdown, playerDropdownChanged, setSelectPlayer = Library.createPlayerDropdown(miscContentRight, rectangle)
    local autoDropToggleBtn = Library.createToggleButton(miscContentRight, "Auto Drop for Player", toggleStates.AutoDropItems); autoDropToggleBtn.MouseButton1Click:Connect(function() toggleStates.AutoDropItems = not toggleStates.AutoDropItems; if toggleStates.AutoDropItems then if not toggleStates.UnlimitedWeaponDrop then Library.createNotification("Error", "You must toggle 'Drop All Weapons on Death' ON first!", 4); toggleStates.AutoDropItems = false; return end; Library.createNotification("Action", "Auto Drop Enabled.", 3); task.spawn(function() while toggleStates.AutoDropItems do local targetPlayerName = getSelectedPlayer(); local targetPlayer = Players:FindFirstChild(targetPlayerName); local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart"); local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid"); if targetPlayer and targetPlayer.Character and root and humanoid and targetPlayer ~= LocalPlayer then local targetHRP = targetPlayer.Character:FindFirstChild("HumanoidRootPart"); if targetHRP then root.CFrame = targetHRP.CFrame * CFrame.new(0, 3, 0); task.wait(0.2); humanoid.Health = 0; task.wait(5) else task.wait(1) end else if not targetPlayer or targetPlayer == LocalPlayer then Library.createNotification("Error", "Select a valid player to drop for.", 2); task.wait(5) else task.wait(1) end end end end) else Library.createNotification("Action", "Auto Drop Disabled.", 3) end end)
    print("PC Misc tab content loaded!")

    -- ===================================================================
    -- ### 9. CREATE THE PC "SETTINGS" PAGE CONTENT (Function)
    -- ===================================================================
    local function createSettingsTab(settingsPage, rectangle)
        local getToggleKey, setToggleKey, getWatermarkTrans, setWatermarkTrans, transChanged, getWatermarkFontSize, setWatermarkFontSize, fontSizeChanged, getWatermarkX, setWatermarkX, xPosChanged, getWatermarkY, setWatermarkY, yPosChanged, getTheme, setTheme
        local uiSettingsSection, uiSettingsContent = Library.createBigSection(settingsPage, "UI Settings", Library.Positions.Big)
        local themeSection, themeContent = Library.createBigSection(settingsPage, "Theme", Library.Positions.SmallTop)
        local keybindButton; keybindButton, getToggleKey, setToggleKey = Library.createKeybind(uiSettingsContent, "Toggle UI", currentSettings.ToggleKey); allUIElements.ToggleKey = setToggleKey
        local resetSettingsButton = Library.createButton(uiSettingsContent, "Reset Config"); local saveSettingsButton = Library.createButton(uiSettingsContent, "Save Config"); local loadSettingsButton = Library.createButton(uiSettingsContent, "Load Config"); local unloadButton = Library.createButton(uiSettingsContent, "Unload UI"); Library.createDivider(uiSettingsContent)
        local transparencySlider; transparencySlider, getWatermarkTrans, transChanged, setWatermarkTrans = Library.createSlider(uiSettingsContent, "Watermark Transparency", 0, 100, currentSettings.WatermarkTransparency, rectangle); local fontSizeSlider; fontSizeSlider, getWatermarkFontSize, fontSizeChanged, setWatermarkFontSize = Library.createSlider(uiSettingsContent, "Watermark Font Size", 10, 24, currentSettings.WatermarkFontSize, rectangle); local xPosSlider; xPosSlider, getWatermarkX, xPosChanged, setWatermarkX = Library.createSlider(uiSettingsContent, "Watermark X Position", 0, 100, currentSettings.WatermarkX, rectangle); local yPosSlider; yPosSlider, getWatermarkY, yPosChanged, setWatermarkY = Library.createSlider(uiSettingsContent, "Watermark Y Position", 0, 100, currentSettings.WatermarkY, rectangle)
        transChanged:Connect(function(value) local watermark = PlayerGui:FindFirstChild("WatermarkGui"); if watermark and watermark.WatermarkLabel then watermark.WatermarkLabel.BackgroundTransparency = value / 100; currentSettings.WatermarkTransparency = value end end)
        fontSizeChanged:Connect(function(value) local watermark = PlayerGui:FindFirstChild("WatermarkGui"); if watermark and watermark.WatermarkLabel then local size = math.floor(value); watermark.WatermarkLabel.TextSize = size; currentSettings.WatermarkFontSize = size end end)
        xPosChanged:Connect(function(value) local watermark = PlayerGui:FindFirstChild("WatermarkGui"); if watermark and watermark.WatermarkLabel then local x = value / 100; watermark.WatermarkLabel.AnchorPoint = Vector2.new(x, watermark.WatermarkLabel.AnchorPoint.Y); watermark.WatermarkLabel.Position = UDim2.new(x, 0, watermark.WatermarkLabel.Position.Y.Scale, 0); currentSettings.WatermarkX = value end end)
        yPosChanged:Connect(function(value) local watermark = PlayerGui:FindFirstChild("WatermarkGui"); if watermark and watermark.WatermarkLabel then local y = value / 100; watermark.WatermarkLabel.AnchorPoint = Vector2.new(watermark.WatermarkLabel.AnchorPoint.X, y); watermark.WatermarkLabel.Position = UDim2.new(watermark.WatermarkLabel.Position.X.Scale, 0, y, 0); currentSettings.WatermarkY = value end end)
        allUIElements.WatermarkTransparency = setWatermarkTrans; allUIElements.WatermarkFontSize = setWatermarkFontSize; allUIElements.WatermarkX = setWatermarkX; allUIElements.WatermarkY = setWatermarkY
        local themeNames = {"Blue (Default)", "Red", "Orange", "Light Purple", "Dark Purple", "Yellow", "Dark Green", "Light Green"}; local themeColorMap = {["Blue (Default)"] = Color3.fromRGB(0, 100, 255), ["Red"] = Color3.fromRGB(255, 0, 0), ["Orange"] = Color3.fromRGB(255, 165, 0), ["Light Purple"] = Color3.fromRGB(170, 0, 255), ["Dark Purple"] = Color3.fromRGB(100, 0, 255), ["Yellow"] = Color3.fromRGB(255, 255, 0), ["Dark Green"] = Color3.fromRGB(0, 150, 0), ["Light Green"] = Color3.fromRGB(0, 255, 0)}
        local themeDropdown, _, themeChanged; themeDropdown, getTheme, _, themeChanged, setTheme = Library.createDropdown(themeContent, "Select Theme", themeNames, rectangle); allUIElements.Theme = setTheme
        themeChanged:Connect(function(selectedThemeName) local newColor = themeColorMap[selectedThemeName]; if newColor then Library.setThemeColor(newColor, titleLabel, subtitleLabel); currentSettings.Theme = selectedThemeName end end)
        unloadButton.MouseButton1Click:Connect(function() mainScreenGui:Destroy(); if PlayerGui:FindFirstChild("WatermarkGui") then PlayerGui:FindFirstChild("WatermarkGui"):Destroy() end; if PlayerGui:FindFirstChild("ToggleGui") then PlayerGui:FindFirstChild("ToggleGui"):Destroy() end end)
        resetSettingsButton.MouseButton1Click:Connect(function() for settingName, defaultValue in pairs(defaultSettings) do local setValueFunc = allUIElements[settingName]; if setValueFunc then setValueFunc(defaultValue); currentSettings[settingName] = defaultValue end end; Library.setThemeColor(themeColorMap[defaultSettings.Theme], titleLabel, subtitleLabel); Library.createNotification("BlindHub", "Settings reset to default.") end)
        saveSettingsButton.MouseButton1Click:Connect(function() if not HttpService_Success then Library.createNotification("Error", "HttpService disabled. Cannot save config."); return end; currentSettings.Theme = getTheme(); currentSettings.ToggleKey = getToggleKey().Name; currentSettings.WatermarkTransparency = getWatermarkTrans(); currentSettings.WatermarkFontSize = getWatermarkFontSize(); currentSettings.WatermarkX = getWatermarkX(); currentSettings.WatermarkY = getWatermarkY(); if writefile then local success, data = pcall(HttpService.JSONEncode, HttpService, currentSettings); if success then writefile("BlindHubConfig.json", data); Library.createNotification("BlindHub", "Config saved!") else Library.createNotification("BlindHub", "Error saving config.") end else Library.createNotification("BlindHub", "writefile() is not supported.") end end)
        loadSettingsButton.MouseButton1Click:Connect(function() if not HttpService_Success then Library.createNotification("Error", "HttpService disabled. Cannot load config."); return end; if type(isfile) == "function" and isfile("BlindHubConfig.json") and type(readfile) == "function" then local success, data = pcall(readfile, "BlindHubConfig.json"); if not success then Library.createNotification("BlindHub", "Error reading config file."); return end; local loadedSettings; success, loadedSettings = pcall(HttpService.JSONDecode, HttpService, data); if not success then Library.createNotification("BlindHub", "Error decoding config file."); return end; for settingName, value in pairs(loadedSettings) do local setValueFunc = allUIElements[settingName]; if setValueFunc then local valueToSet = value or defaultSettings[settingName]; if valueToSet ~= nil then setValueFunc(valueToSet); currentSettings[settingName] = valueToSet end end end; Library.setThemeColor(themeColorMap[currentSettings.Theme], titleLabel, subtitleLabel); Library.createNotification("BlindHub", "Config loaded!") else Library.createNotification("BlindHub", "No config file found.") end end)
    end

    -- ===================================================================
    -- ### 10. RUN THE PC "SETTINGS" FUNCTION
    -- ===================================================================
    if settingsPage then createSettingsTab(settingsPage, rectangle); print("PC Settings tab content loaded!") end

    -- ===================================================================
    -- ### 11. PC FINAL SETUP (Keybinds, Watermark, etc.)
    -- ===================================================================
    game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessed) if gameProcessed then return end; if input.KeyCode == currentSettings.ToggleKey then setUIVisible(not mainScreenGui.Enabled) end end)
    Library.createWatermark("using: \nBlindHubOfficial", currentSettings.WatermarkFontSize, currentSettings.WatermarkTransparency, currentSettings.WatermarkX, currentSettings.WatermarkY)

    -- ===================================================================
    -- ### 12. PC BACKGROUND LOOPS
    -- ===================================================================
    RunService.Heartbeat:Connect(function() if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then local h = LocalPlayer.Character.Humanoid; if toggleStates.Walkspeed then h.WalkSpeed = player_WS_Value end; if toggleStates.JumpPower then h.JumpPower = player_JP_Value end end end)
    RunService.RenderStepped:Connect(function()
        if toggleStates.PlayerInfo then local lpHRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart"); if not lpHRP then return end; for p, cache in pairs(playerInfoCache) do local tHRP = p.Character and p.Character:FindFirstChild("HumanoidRootPart"); local h = p.Character and p.Character:FindFirstChildOfClass("Humanoid"); if tHRP and h and cache.textLabel and cache.textLabel.Parent then cache.textLabel.Text = string.format("%s\nHealth: %.0f | Dist: %.0f", p.Name, h.Health, (lpHRP.Position - tHRP.Position).magnitude); cache.textLabel.TextColor3 = p.TeamColor.Color end end end
        if toggleStates.HighlightESP then for p, h in pairs(highlights) do if p and p.Parent and h and h.Parent then h.FillColor, h.OutlineColor = p.TeamColor.Color, p.TeamColor.Color end end end
        if toggleStates.BoxESP then for p, l in pairs(BoxESPObjects) do local char, hrp, hum, head = p.Character, p.Character and p.Character:FindFirstChild("HumanoidRootPart"), p.Character and p.Character:FindFirstChildOfClass("Humanoid"), p.Character and p.Character:FindFirstChild("Head"); if p and p.Parent and hrp and hum and hum.Health > 0 and head then local pos, onScreen = Camera:WorldToViewportPoint(hrp.Position); if onScreen then local headPos = Camera:WorldToViewportPoint(head.Position); local dist = math.clamp((Vector2.new(headPos.X, headPos.Y) - Vector2.new(pos.X, pos.Y)).magnitude, 2, math.huge); local function setPoints(item) item.PointA = Vector2.new(pos.X + dist, pos.Y - dist * 2); item.PointB = Vector2.new(pos.X - dist, pos.Y - dist * 2); item.PointC = Vector2.new(pos.X - dist, pos.Y + dist * 2); item.PointD = Vector2.new(pos.X + dist, pos.Y + dist * 2) end; setPoints(l.box); setPoints(l.black); l.box.Color = p.TeamColor.Color; BoxVis(true, l) else BoxVis(false, l) end else BoxVis(false, l) end end end
        if toggleStates.Tracers then for p, t in pairs(tracerDrawings) do local hrp = p and p.Character and p.Character:FindFirstChild("HumanoidRootPart"); if hrp then local pos, on = Camera:WorldToViewportPoint(hrp.Position); if on then t.Color, t.From, t.To, t.Visible = p.TeamColor.Color, Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y), Vector2.new(pos.X, pos.Y), true else t.Visible = false end else t.Visible = false end end end
        if fovCircleDrawing and toggleStates.ShowFOV then fovCircleDrawing.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2) end
    end)
    
    -- [MODIFIED] Changed this print message
    print("BlindHubOfficial (PC) loaded successfully "); print("Welcome to BlindHubOfficial!")
end


-- ===================================================================
-- 4. DEFINE MOBILE HUB FUNCTION (YOUR ORIGINAL VALLEY PRISON UI)
-- ===================================================================
function InitializeMainHub()
    -- NOTE: Services (Players, Workspace, etc.) are already loaded in the global scope
    -- NOTE: BlindHubsUiLibrary is already loaded in the global scope

    BlindHubsUiLibrary.Init()
    local Themes = {["Purple"] = Color3.fromRGB(98, 54, 255),["Pink"] = Color3.fromRGB(255, 105, 180),["Red"] = Color3.fromRGB(255, 20, 20),["Blue"] = Color3.fromRGB(21, 67, 189),["Green"] = Color3.fromRGB(0, 175, 0),["Orange"] = Color3.fromRGB(255, 128, 0),["Black"] = Color3.fromRGB(0, 0, 0)}
    local Window = BlindHubsUiLibrary.CreateWindow({ Title = "BlindHubOfficial: Valley Prison", DefaultTheme = "Orange" })

    -- [SCOPE_FIX] Declare variables used in loops here
    local walkspeedToggle, walkspeedSlider, jumpPowerToggle, jumpPowerSlider

    -- Helper Functions
    local PlayerInfoConfig = { Enabled = false, Font = Enum.Font.SourceSansBold, TextSize = 15, Offset = Vector3.new(0, 3, 0) }; local playerInfoCache = {}; local highlights, highlightESPEnabled = {}, false; local BoxESPObjects, BoxESPEnabled = {}, false; local tracersEnabled, tracerConnections, tracerDrawings = false, {}, {}; local function cleanupPlayerInfo(player) if playerInfoCache[player] and playerInfoCache[player].billboard then pcall(function() playerInfoCache[player].billboard:Destroy() end) end; playerInfoCache[player] = nil end; local function createPlayerInfo(player) if player == LocalPlayer then return end; cleanupPlayerInfo(player); local char = player.Character; if not char then return end; local head = char:WaitForChild("Head", 5); if not head then return end; local b = Instance.new('BillboardGui', head); b.Name, b.Adornee, b.Size, b.StudsOffset, b.AlwaysOnTop, b.LightInfluence = player.Name .. "-InfoESP", head, UDim2.new(0, 200, 0, 45), PlayerInfoConfig.Offset, true, 0; local t = Instance.new('TextLabel', b); t.Name, t.Size, t.BackgroundTransparency, t.TextStrokeTransparency, t.Font, t.TextSize = 'ESPLabel', UDim2.fromScale(1, 1), 1, 0.5, PlayerInfoConfig.Font, PlayerInfoConfig.TextSize; playerInfoCache[player] = { billboard = b, textLabel = t } end; local function createHighlight(p) if highlights[p] or p == LocalPlayer or not p.Character then return end; local h = Instance.new('Highlight', p.Character); h.Name, h.FillTransparency, h.OutlineTransparency, h.DepthMode, h.Adornee = "BH_Highlight", 0.5, 0.5, Enum.HighlightDepthMode.AlwaysOnTop, p.Character; highlights[p] = h end; local function removeHighlight(p) if highlights[p] then pcall(function() highlights[p]:Destroy() end); highlights[p] = nil end end; local function NewQuad(thickness, color) if not Drawing then return nil end; local q = Drawing.new('Quad'); q.Visible, q.PointA, q.PointB, q.PointC, q.PointD, q.Color, q.Filled, q.Thickness = false, Vector2.new(), Vector2.new(), Vector2.new(), Vector2.new(), color, false, thickness; return q end; local function BoxVis(shouldShow, listOfDrawings) for _, obj in pairs(listOfDrawings) do if obj then obj.Visible = shouldShow end end end; local function teardownBox(player) if BoxESPObjects[player] then for _, d in pairs(BoxESPObjects[player]) do if d then pcall(function() d:Destroy() end) end end; BoxESPObjects[player] = nil end end; local function CreateBoxESP(p) if BoxESPObjects[p] or p == LocalPlayer then return end; local quad_black, quad_box = NewQuad(2, Color3.new()), NewQuad(1, p.TeamColor.Color); if not quad_black or not quad_box then return end; BoxESPObjects[p] = {black = quad_black, box = quad_box} end
    
    -- [FINAL UPDATED FUNCTION - CHECKS BACKPACK]
    local function isTargetHostile(targetPlayer)
        if not targetPlayer then return false end
        local safeItems = {["taco"] = true,["donut"] = true,["chocolate milk"] = true,["hot chocolate"] = true,["sandwich"] = true,["turkeyleg"] = true, ["food tray"] = true,["weights"] = true,["nachos"] = true,["bloxycola"] = true,["pizza"] = true,["cheezburger"] = true,["sign"] = true,["book"] = true}
        local allToolsToCheck = {}
        local character = targetPlayer.Character
        if character then
            local equippedTool = character:FindFirstChildOfClass("Tool")
            if equippedTool then table.insert(allToolsToCheck, equippedTool) end
        end
        local backpack = targetPlayer:FindFirstChildOfClass("Backpack")
        if backpack then
            for _, item in ipairs(backpack:GetChildren()) do
                if item:IsA("Tool") then table.insert(allToolsToCheck, item) end
            end
        end
        if #allToolsToCheck == 0 then return false end
        for _, tool in ipairs(allToolsToCheck) do
            local toolName = tool.Name:lower()
            if not safeItems[toolName] then return true end
        end
        return false
    end

    -- Main Tab
    local MainTab = Window:CreateMainTab(); task.wait(0.1); local originalButton; for _, child in ipairs(MainTab.page:GetChildren()) do if child:IsA("TextButton") and string.find(child.Text:lower(), "discord") then originalButton = child; break end end; if originalButton then local buttonClone = originalButton:Clone(); buttonClone.Parent = originalButton.Parent; buttonClone.LayoutOrder = originalButton.LayoutOrder; originalButton:Destroy(); buttonClone.MouseButton1Click:Connect(function() if setclipboard then setclipboard("https://discord.gg/blindhub"); BlindHubsUiLibrary.CreateNotification("Discord Link", "Copied to clipboard!", 3) end end) end

    -- ===================================================================
    -- [START] MOBILE ESP Tab (Your original)
    -- ===================================================================
    local ESPTab = Window:AddTab("ESP"); ESPTab:AddLabel("Player ESP"); local infoToggle = ESPTab:AddToggle("Player Info"); local infoPlayerAddedConn, infoPlayerRemovingConn, infoCharacterAddedConns = nil, nil, {}; infoToggle:FindFirstChild("State").Changed:Connect(function(enabled) PlayerInfoConfig.Enabled = enabled; local function setupInfo(player) if player == LocalPlayer then return end; if infoCharacterAddedConns[player] then infoCharacterAddedConns[player]:Disconnect() end; if player.Character then createPlayerInfo(player) end; infoCharacterAddedConns[player] = player.CharacterAdded:Connect(function() task.wait(0.1); createPlayerInfo(player) end) end; local function teardownInfo(player) cleanupPlayerInfo(player); if infoCharacterAddedConns[player] then infoCharacterAddedConns[player]:Disconnect(); infoCharacterAddedConns[player] = nil end end; if enabled then infoPlayerAddedConn = Players.PlayerAdded:Connect(setupInfo); infoPlayerRemovingConn = Players.PlayerRemoving:Connect(teardownInfo); for _, p in ipairs(Players:GetPlayers()) do setupInfo(p) end else if infoPlayerAddedConn then infoPlayerAddedConn:Disconnect() end; if infoPlayerRemovingConn then infoPlayerRemovingConn:Disconnect() end; for _, p in ipairs(Players:GetPlayers()) do teardownInfo(p) end end end); ESPTab:AddLabel("Visuals"); local highlightToggle = ESPTab:AddToggle("Highlight ESP"); local highlightPlayerAddedConn, highlightPlayerRemovingConn, highlightCharacterAddedConns = nil, nil, {}; highlightToggle:FindFirstChild("State").Changed:Connect(function(enabled) highlightESPEnabled = enabled; local function setupHighlight(player) if player == LocalPlayer then return end; if highlightCharacterAddedConns[player] then highlightCharacterAddedConns[player]:Disconnect() end; if player.Character then createHighlight(player) end; highlightCharacterAddedConns[player] = player.CharacterAdded:Connect(function() removeHighlight(player); task.wait(0.1); createHighlight(player) end) end; local function teardownHighlight(player) removeHighlight(player); if highlightCharacterAddedConns[player] then highlightCharacterAddedConns[player]:Disconnect(); highlightCharacterAddedConns[player] = nil end end; if enabled then highlightPlayerAddedConn = Players.PlayerAdded:Connect(setupHighlight); highlightPlayerRemovingConn = Players.PlayerRemoving:Connect(teardownHighlight); for _, p in ipairs(Players:GetPlayers()) do setupHighlight(p) end else if highlightPlayerAddedConn then highlightPlayerAddedConn:Disconnect() end; if highlightPlayerRemovingConn then highlightPlayerRemovingConn:Disconnect() end; for _, p in ipairs(Players:GetPlayers()) do teardownHighlight(p) end end end); local boxToggle = ESPTab:AddToggle("Box ESP"); local boxPlayerAddedConn, boxPlayerRemovingConn; boxToggle:FindFirstChild("State").Changed:Connect(function(enabled) BoxESPEnabled = enabled; if enabled then boxPlayerAddedConn = Players.PlayerAdded:Connect(function(p) if p ~= LocalPlayer then CreateBoxESP(p) end end); boxPlayerRemovingConn = Players.PlayerRemoving:Connect(teardownBox); for _, p in pairs(Players:GetPlayers()) do if p ~= LocalPlayer then CreateBoxESP(p) end end else if boxPlayerAddedConn then boxPlayerAddedConn:Disconnect() end; if boxPlayerRemovingConn then boxPlayerRemovingConn:Disconnect() end; for p, _ in pairs(BoxESPObjects) do teardownBox(p) end end end); local tracersToggle = ESPTab:AddToggle("Tracers"); local tracerPlayerAddedConn, tracerPlayerRemovingConn; tracersToggle:FindFirstChild("State").Changed:Connect(function(enabled) tracersEnabled = enabled; local function setupTracer(p) if tracersEnabled and not tracerDrawings[p] and p.Character and p ~= LocalPlayer and Drawing then local t = Drawing.new('Line'); t.Visible, t.Thickness = false, 1; tracerDrawings[p] = t end end; local function teardownTracer(p) if tracerDrawings[p] then pcall(function() tracerDrawings[p]:Destroy() end); tracerDrawings[p] = nil end end; if enabled then for _, p in pairs(Players:GetPlayers()) do setupTracer(p) end; tracerPlayerAddedConn = Players.PlayerAdded:Connect(setupTracer); tracerPlayerRemovingConn = Players.PlayerRemoving:Connect(teardownTracer) else if tracerPlayerAddedConn then tracerPlayerAddedConn:Disconnect() end; if tracerPlayerRemovingConn then tracerPlayerRemovingConn:Disconnect() end; for p, t in pairs(tracerDrawings) do if t then pcall(function() t:Destroy() end) end end; tracerDrawings = {} end end)
    -- ===================================================================
    -- [END] MOBILE ESP Tab
    -- ===================================================================

    -- ===================================================================
    -- [START] MOBILE Player Tab (Your original)
    -- ===================================================================
    local PlayerTab = Window:AddTab("Player");
    
    -- Store original values
    local originalWalkSpeed = 16
    local originalJumpPower = 50
    local originalMaxZoomDistance = LocalPlayer.CameraMaxZoomDistance or 128
    local originalDevCameraMode = LocalPlayer.DevCameraOcclusionMode or Enum.DevCameraOcclusionMode.Zoom
    
    pcall(function()
        originalWalkSpeed = LocalPlayer.Character.Humanoid.WalkSpeed
        originalJumpPower = LocalPlayer.Character.Humanoid.JumpPower
        originalMaxZoomDistance = LocalPlayer.CameraMaxZoomDistance
        originalDevCameraMode = LocalPlayer.DevCameraOcclusionMode
    end);
    
    PlayerTab:AddLabel("Movement");
    -- [SCOPE_FIX] Assign to the variables declared at the top
    walkspeedToggle = PlayerTab:AddToggle("Walkspeed"); walkspeedSlider = PlayerTab:AddSlider({Text = "Speed", Min = 16, Max = 900, Default = originalWalkSpeed}); walkspeedSlider.Visible = false; walkspeedToggle:FindFirstChild("State").Changed:Connect(function(enabled) walkspeedSlider.Visible = enabled; if not enabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then LocalPlayer.Character.Humanoid.WalkSpeed = originalWalkSpeed end end);
    jumpPowerToggle = PlayerTab:AddToggle("JumpPower"); jumpPowerSlider = PlayerTab:AddSlider({Text = "Power", Min = 14, Max = 500, Default = 14}); jumpPowerSlider.Visible = false; jumpPowerToggle:FindFirstChild("State").Changed:Connect(function(enabled) jumpPowerSlider.Visible = enabled; if not enabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then LocalPlayer.Character.Humanoid.JumpPower = originalJumpPower end end);
    
    PlayerTab:AddLabel("Infinite");
    local infJumpConnection; local infJumpToggle = PlayerTab:AddToggle("Infinite Jump"); infJumpToggle:FindFirstChild("State").Changed:Connect(function(enabled) if infJumpConnection then infJumpConnection:Disconnect() end; if enabled then infJumpConnection = UserInputService.JumpRequest:Connect(function() if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then LocalPlayer.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping) end end) end end);
    local infStaminaToggle = PlayerTab:AddToggle("Inf Stamina"); local originalStaminaValue, originalMaxStaminaValue; local stamina, maxStamina; pcall(function() stamina = LocalPlayer:WaitForChild("ServerVariables", 5):WaitForChild("Sprint", 2):WaitForChild("Stamina", 2); maxStamina = LocalPlayer:WaitForChild("ServerVariables", 5):WaitForChild("Sprint", 2):WaitForChild("MaxStamina", 2) end); infStaminaToggle:FindFirstChild("State").Changed:Connect(function(enabled) if not stamina or not maxStamina then BlindHubsUiLibrary.CreateNotification("Error", "Stamina variables not found.", 5); infStaminaToggle:FindFirstChild("State").Value = false; return end; if enabled then if originalStaminaValue == nil then originalStaminaValue = stamina.Value end; if originalMaxStaminaValue == nil then originalMaxStaminaValue = maxStamina.Value end; stamina.Value, maxStamina.Value = math.huge, math.huge else if originalStaminaValue ~= nil then stamina.Value = originalStaminaValue end; if originalMaxStaminaValue ~= nil then maxStamina.Value = originalMaxStaminaValue end end end);
    local infCamZoomToggle = PlayerTab:AddToggle("Inf cam zoom")
    infCamZoomToggle:FindFirstChild("State").Changed:Connect(function(enabled)
        if enabled then
            LocalPlayer.CameraMaxZoomDistance = 100000
        else
            LocalPlayer.CameraMaxZoomDistance = originalMaxZoomDistance
        end
    end)

    PlayerTab:AddLabel("Camera");
    local invisicamToggle = PlayerTab:AddToggle("invisible cam")
    invisicamToggle:FindFirstChild("State").Changed:Connect(function(enabled)
        if enabled then
            LocalPlayer.DevCameraOcclusionMode = Enum.DevCameraOcclusionMode.Invisicam
        else
            LocalPlayer.DevCameraOcclusionMode = originalDevCameraMode
        end
    end)
    local thirdPersonMobileEnabled = false
    local thirdPersonToggle = PlayerTab:AddToggle("Third Person (Mobile)")
    thirdPersonToggle:FindFirstChild("State").Changed:Connect(function(enabled)
        thirdPersonMobileEnabled = enabled
        if enabled then
            if LocalPlayer.CameraMode == Enum.CameraMode.LockFirstPerson then
                LocalPlayer.CameraMode = Enum.CameraMode.Classic
                BlindHubsUiLibrary.CreateNotification("Camera", "Forced Third Person", 1.5)
            end
        else
            local character = LocalPlayer.Character
            local humanoid = character and character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                local equippedTool = humanoid:GetEquippedTool()
                if equippedTool then
                    LocalPlayer.CameraMode = Enum.CameraMode.LockFirstPerson
                    BlindHubsUiLibrary.CreateNotification("Camera", "Restored First Person", 1.5)
                end
            end
        end
    end)
    LocalPlayer:GetPropertyChangedSignal("CameraMode"):Connect(function()
        if thirdPersonMobileEnabled and LocalPlayer.CameraMode == Enum.CameraMode.LockFirstPerson then
            LocalPlayer.CameraMode = Enum.CameraMode.Classic
        end
    end)

    PlayerTab:AddLabel("Interaction");
    PlayerTab:AddButton("Tp to Card").MouseButton1Click:Connect(function()
        if type(fireproximityprompt) ~= "function" then return BlindHubsUiLibrary.CreateNotification("Error", "fireproximityprompt not supported.", 4) end
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if not hrp then return BlindHubsUiLibrary.CreateNotification("Error", "Character not found.", 3) end
        local map = Workspace:WaitForChild("Map", 15)
        if not map then return BlindHubsUiLibrary.CreateNotification("Error", "Map did not load in time.", 4) end
        local keycardsFolder = map:FindFirstChild("Keycards")
        if not keycardsFolder then return BlindHubsUiLibrary.CreateNotification("Error", "Keycards folder not found.", 3) end
        for _, cardModel in ipairs(keycardsFolder:GetChildren()) do
            local prompt = cardModel:FindFirstChildOfClass("ProximityPrompt", true)
            if prompt and prompt.Enabled then
                hrp.CFrame = prompt.Parent.CFrame * CFrame.new(0, 3, 0)
                task.wait(0.2)
                fireproximityprompt(prompt)
                return BlindHubsUiLibrary.CreateNotification("Keycard", "Teleporting to " .. cardModel.Name, 3)
            end
        end
        BlindHubsUiLibrary.CreateNotification("Keycard", "No available keycards found.", 4)
    end)
    PlayerTab:AddButton("Become Criminal").MouseButton1Click:Connect(function() local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart"); if not hrp then return BlindHubsUiLibrary.CreateNotification("Error", "Character not found.", 3) end; local escapeBarriersFolder = Workspace.Map:FindFirstChild("Functional", true) and Workspace.Map.Functional:FindFirstChild("Invisible", true) and Workspace.Map.Functional.Invisible:FindFirstChild("EscapeBarriers", true); if escapeBarriersFolder then local barriers = escapeBarriersFolder:GetChildren(); if #barriers > 0 then local targetBarrier = barriers[math.min(10, #barriers)]; hrp.CFrame = targetBarrier.CFrame * CFrame.new(0, 3, 0); BlindHubsUiLibrary.CreateNotification("Criminal", "Teleported to escape point.", 3) else BlindHubsUiLibrary.CreateNotification("Error", "No escape barriers found.", 4) end else BlindHubsUiLibrary.CreateNotification("Error", "Could not find EscapeBarriers folder.", 4) end end)
    -- ===================================================================
    -- [END] MOBILE Player Tab
    -- ===================================================================

    -- ===================================================================
    -- [START] MOBILE Aimbot/Fov Tab (MODIFIED WITH NEW FEATURES)
    -- ===================================================================
    local AimbotFovTab = Window:AddTab("Aimbot/Fov")
    AimbotFovTab:AddLabel("Aimbot")
    
    local aimbotTargetPart = "Head" -- Default to Head
    
    local aimbotEnabled = false; local wallCheckEnabled = false; local teamCheckEnabled = false; local aimbotMaxDistance = 500; local showFovCircle = false; local fovCircleRadius = 150; local aimbotStrength = 1.0; local aimbotTarget = nil; local fovCircleDrawing = nil; local lockOnButtonToggle = nil; local lockOnScreenButton = nil; local isLockOnActive = false
    
    -- Weapon Mod Variables
    local isRapidFireEnabled = false
    local isAccurateShotsEnabled = false
    local isFullAutoEnabled = false -- [NEW]
    local originalRPMs = {}
    local originalAccuracies = {}
    local originalFiremodes = {} -- [NEW]
    
    -- Declare all UI elements first (for scope)
    local aimbotToggle, aimbotPartDropdown, rapidFireToggle, accurateShotsToggle, fullAutoToggle, lockOnButtonToggle, showFovToggle, wallCheckToggle, teamCheckToggle, fovRadiusSlider, aimbotDistanceSlider, aimbotStrengthSlider
    
    -- [NEW] Helper function for Full Auto
    local function SetFiremode(tool, enabled)
        if not tool or not tool:IsA("Tool") then return end
        
        local firemodeValue = tool:FindFirstChild("Variables", true)
        if firemodeValue then
            firemodeValue = firemodeValue:FindFirstChild("CurFiremode")
        end
        
        if firemodeValue and firemodeValue:IsA("StringValue") then
            if enabled then
                if not originalFiremodes[tool] then
                    originalFiremodes[tool] = firemodeValue.Value -- Save original
                end
                firemodeValue.Value = "Auto"
            else
                if originalFiremodes[tool] then
                    firemodeValue.Value = originalFiremodes[tool] -- Restore original
                    originalFiremodes[tool] = nil -- Clear cache
                end
            end
        end
    end

    -- Weapon Mod Function (Rapid Fire / Accurate Shots)
    local function SetWeaponValue(tool, propertyName, enabled, value, originalValuesTable) if not tool then return end; local valueObject = tool:FindFirstChild("LocalConfig", true); if valueObject then valueObject = valueObject:FindFirstChild("Configuration", true) end; if valueObject then valueObject = valueObject:FindFirstChild(propertyName, true) end; if valueObject and valueObject:IsA("ValueBase") then if enabled then if not originalValuesTable[tool] then originalValuesTable[tool] = valueObject.Value end; valueObject.Value = value else if originalValuesTable[tool] then valueObject.Value = originalValuesTable[tool]; originalValuesTable[tool] = nil end end end end
    
    -- [MODIFIED] This now handles all weapon mods
    local function HandleCharacter(character) 
        character.ChildAdded:Connect(function(child) 
            if child:IsA("Tool") then 
                task.wait(0.1) 
                SetFiremode(child, isFullAutoEnabled) -- [NEW]
                if isRapidFireEnabled then SetWeaponValue(child, "RPM", true, math.huge, originalRPMs) end
                if isAccurateShotsEnabled then SetWeaponValue(child, "Accuracy", true, Vector3.new(0, 0, 0), originalAccuracies) end
            end 
        end)
        character.ChildRemoved:Connect(function(child) 
            if child:IsA("Tool") then 
                SetFiremode(child, false) -- [NEW] Always revert on unequip
                SetWeaponValue(child, "RPM", false, nil, originalRPMs)
                SetWeaponValue(child, "Accuracy", false, nil, originalAccuracies)
            end 
        end)
        local currentTool = character:FindFirstChildOfClass("Tool")
        if currentTool then 
            SetFiremode(currentTool, isFullAutoEnabled) -- [NEW]
            if isRapidFireEnabled then SetWeaponValue(currentTool, "RPM", true, math.huge, originalRPMs) end
            if isAccurateShotsEnabled then SetWeaponValue(currentTool, "Accuracy", true, Vector3.new(0, 0, 0), originalAccuracies) end
        end 
    end
    
    -- [FIXED] Lock On Button logic
    local function CreateLockOnScreenButton() 
        if CoreGui:FindFirstChild("BlindHubLockOnGui") then return end
        local screenGui = Instance.new("ScreenGui"); screenGui.Name = "BlindHubLockOnGui"; screenGui.ResetOnSpawn = false; screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global; screenGui.Parent = CoreGui
        lockOnScreenButton = Instance.new("TextButton"); 
        lockOnScreenButton.Name = "LockOnButton"; 
        lockOnScreenButton.Size = UDim2.fromOffset(120, 40); 
        lockOnScreenButton.Position = UDim2.new(0.5, 0, 0.85, 0); 
        lockOnScreenButton.AnchorPoint = Vector2.new(0.5, 0); 
        lockOnScreenButton.BackgroundColor3 = Color3.fromRGB(45, 45, 55); 
        lockOnScreenButton.Font = Enum.Font.GothamSemibold; 
        lockOnScreenButton.Text = "Lock On"; 
        lockOnScreenButton.TextColor3 = Color3.fromRGB(220, 220, 220); 
        lockOnScreenButton.TextSize = 16; 
        lockOnScreenButton.Draggable = true; 
        lockOnScreenButton.Active = true; 
        lockOnScreenButton.Parent = screenGui
        Instance.new("UICorner", lockOnScreenButton).CornerRadius = UDim.new(0, 8)
        local stroke = Instance.new("UIStroke", lockOnScreenButton); 
        stroke.Color = Color3.fromRGB(120, 80, 220); 
        stroke.Thickness = 1.5
        
        -- [FIXED] Use MouseButton1Click for toggle behavior
        lockOnScreenButton.MouseButton1Click:Connect(function()
            -- Toggle the active state
            isLockOnActive = not isLockOnActive 
            
            -- Update the button's appearance
            if isLockOnActive then
                lockOnScreenButton.BackgroundColor3 = Color3.fromRGB(70, 200, 70)
                lockOnScreenButton.Text = "LOCKED"
            else
                lockOnScreenButton.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
                lockOnScreenButton.Text = "Lock On"
            end
        end)
    end
    
    local function DestroyLockOnScreenButton() isLockOnActive = false; local existingGui = CoreGui:FindFirstChild("BlindHubLockOnGui"); if existingGui then existingGui:Destroy() end; lockOnScreenButton = nil end
    
    -- Create Aimbot toggle
    aimbotToggle = AimbotFovTab:AddToggle("Aimbot")
    
    -- Create all the options that will be hidden
    aimbotPartDropdown = AimbotFovTab:AddDropdown({ Text = "Aimbot Part", Options = {"Head", "Torso"} }); aimbotPartDropdown.Visible = false 
    lockOnButtonToggle = AimbotFovTab:AddToggle("Lock On Button"); lockOnButtonToggle.Visible = false
    showFovToggle = AimbotFovTab:AddToggle("Show FOV Circle"); showFovToggle.Visible = false
    wallCheckToggle = AimbotFovTab:AddToggle("Wall Check"); wallCheckToggle.Visible = false
    teamCheckToggle = AimbotFovTab:AddToggle("Team Check"); teamCheckToggle.Visible = false
    fovRadiusSlider = AimbotFovTab:AddSlider({Text="FOV Radius", Min=50, Max=500, Default=150}); fovRadiusSlider.Visible = false
    aimbotDistanceSlider = AimbotFovTab:AddSlider({Text="Max Distance", Min=50, Max=1500, Default=500}); aimbotDistanceSlider.Visible = false
    aimbotStrengthSlider = AimbotFovTab:AddSlider({Text="Aimbot Strength", Min=0, Max=1000, Default=100}); aimbotStrengthSlider.Visible = false
    
    -- [NEW] Create weapon mods *after* the aimbot toggle
    AimbotFovTab:AddSeparator()
    rapidFireToggle = AimbotFovTab:AddToggle("Rapid Fire")
    accurateShotsToggle = AimbotFovTab:AddToggle("Accurate Shots")
    fullAutoToggle = AimbotFovTab:AddToggle("Full Auto") -- [NEW]

    -- [SCOPE_FIX] Define the aimbot loop *after* all UI elements are created
    local function aimbotLoop()
        -- [FIXED] Check if the button toggle is on AND if the button is pressed
        if not aimbotEnabled or (lockOnButtonToggle and lockOnButtonToggle:FindFirstChild("State").Value and not isLockOnActive) then
            aimbotTarget = nil; return
        end
        local potentialTarget = nil; local smallestDistance3D = aimbotMaxDistance
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                
                local char = player.Character
                local humanoid = char and char:FindFirstChildOfClass("Humanoid")
                
                -- [AIMBOT_FIX_START]
                local partToTarget = nil 
                if char then 
                    if aimbotTargetPart == "Head" then
                        partToTarget = char:FindFirstChild("Head")
                    elseif aimbotTargetPart == "Torso" then
                        -- Check for R15 "UpperTorso" first, then R6 "Torso"
                        partToTarget = char:FindFirstChild("UpperTorso") or char:FindFirstChild("Torso")
                    end
                end
                -- [AIMBOT_FIX_END]
                
                if partToTarget and humanoid and humanoid.Health > 0 then
                    local worldPos = partToTarget.Position; 
                    local screenPos, onScreen = Camera:WorldToViewportPoint(worldPos); 
                    local distance3D = (Camera.CFrame.Position - worldPos).Magnitude
                    
                    if onScreen and distance3D < smallestDistance3D then
                        local cameraLookVector = Camera.CFrame.LookVector
                        local targetVector = (worldPos - Camera.CFrame.Position).Unit
                        local dotProduct = cameraLookVector:Dot(targetVector)
                        if dotProduct > 0 then
                            local distToCenter = (Vector2.new(screenPos.X, screenPos.Y) - Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)).Magnitude
                            if distToCenter <= fovCircleRadius then
                                local passesChecks = true
                                if teamCheckEnabled then
                                    local prisonerTeams = {["Maximum Security"]=true, ["Medium Security"]=true, ["Minimum Security"]=true, ["Booking"]=true, ["Escapee"]=true}; local lawEnforcementTeams = {["Department of Corrections"]=true, ["Sheriff's Office"]=true, ["State Police"]=true}; local myTeamName = LocalPlayer.Team and LocalPlayer.Team.Name; local targetTeamName = player.Team and player.Team.Name
                                    if myTeamName and targetTeamName then
                                        if lawEnforcementTeams[myTeamName] and prisonerTeams[targetTeamName] then if not isTargetHostile(player) then passesChecks = false end
                                        else if (prisonerTeams[myTeamName] or myTeamName == "Civilian") and (prisonerTeams[targetTeamName] or targetTeamName == "Civilian") then passesChecks = false end; if lawEnforcementTeams[myTeamName] and (lawEnforcementTeams[targetTeamName] or targetTeamName == "Civilian") then passesChecks = false end end
                                    end
                                end
                                if passesChecks and wallCheckEnabled then
                                    local playerHead = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Head")
                                    if playerHead then
                                        local raycastParams = RaycastParams.new()
                                        raycastParams.FilterType = Enum.RaycastFilterType.Exclude
                                        raycastParams.FilterDescendantsInstances = {LocalPlayer.Character}
                                        local raycastResult = Workspace:Raycast(playerHead.Position, (partToTarget.Position - playerHead.Position), raycastParams) 
                                        if raycastResult and (not raycastResult.Instance or not raycastResult.Instance:IsDescendantOf(char)) then
                                            passesChecks = false
                                        end
                                    else
                                        passesChecks = false
                                    end
                                end
                                if passesChecks then smallestDistance3D = distance3D; potentialTarget = partToTarget end
                            end
                        end
                    end
                end
            end
        end
        aimbotTarget = potentialTarget
        if aimbotTarget then
            local newCFrame = CFrame.new(Camera.CFrame.Position, aimbotTarget.Position)
            if aimbotStrength >= 0.99 then Camera.CFrame = newCFrame
            else Camera.CFrame = Camera.CFrame:Lerp(newCFrame, aimbotStrength) end
        end
    end
    
    -- Connect Aimbot Toggle logic to show/hide options
    aimbotToggle:FindFirstChild("State").Changed:Connect(function(enabled) 
        aimbotEnabled = enabled; 
        local subOptionsVisible = enabled; 
        
        for _, ui in ipairs({aimbotPartDropdown, lockOnButtonToggle, showFovToggle, wallCheckToggle, teamCheckToggle, fovRadiusSlider, aimbotDistanceSlider, aimbotStrengthSlider}) do 
            ui.Visible = subOptionsVisible 
        end; 
        
        if enabled then 
            RunService:BindToRenderStep("AimbotUpdate", Enum.RenderPriority.Camera.Value + 1, aimbotLoop) 
        else 
            RunService:UnbindFromRenderStep("AimbotUpdate"); 
            aimbotTarget = nil; 
            DestroyLockOnScreenButton(); 
            if lockOnButtonToggle:FindFirstChild("State").Value then lockOnButtonToggle:FindFirstChild("State").Value = false end; 
            if fovCircleDrawing then pcall(function() fovCircleDrawing:Destroy() end); fovCircleDrawing = nil end 
        end 
    end)
    
    -- Connect all the .Changed events
    aimbotPartDropdown.State.Changed:Connect(function(newValue)
        aimbotTargetPart = newValue
        BlindHubsUiLibrary.CreateNotification("Aimbot", "Target part set to: " .. newValue, 2)
    end)
    
    rapidFireToggle:FindFirstChild("State").Changed:Connect(function(enabled) isRapidFireEnabled = enabled; if LocalPlayer.Character then HandleCharacter(LocalPlayer.Character) end end)
    accurateShotsToggle:FindFirstChild("State").Changed:Connect(function(enabled) isAccurateShotsEnabled = enabled; if LocalPlayer.Character then HandleCharacter(LocalPlayer.Character) end end)
    
    -- [NEW] Connect the Full Auto toggle
    fullAutoToggle:FindFirstChild("State").Changed:Connect(function(enabled)
        isFullAutoEnabled = enabled
        if LocalPlayer.Character then
            -- Re-run the check on the currently equipped tool
            HandleCharacter(LocalPlayer.Character)
        end
    end)
    
    lockOnButtonToggle:FindFirstChild("State").Changed:Connect(function(enabled) if enabled then CreateLockOnScreenButton() else DestroyLockOnScreenButton() end end)
    showFovToggle:FindFirstChild("State").Changed:Connect(function(enabled) showFovCircle = enabled; if enabled and not fovCircleDrawing and Drawing then fovCircleDrawing = Drawing.new("Circle"); fovCircleDrawing.Thickness = 1; fovCircleDrawing.NumSides = 64; fovCircleDrawing.Color = Color3.new(1, 1, 1); fovCircleDrawing.Filled = false; fovCircleDrawing.Radius = fovCircleRadius; fovCircleDrawing.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2) end; if fovCircleDrawing then fovCircleDrawing.Visible = enabled end end)
    wallCheckToggle:FindFirstChild("State").Changed:Connect(function(enabled) wallCheckEnabled = enabled end)
    teamCheckToggle:FindFirstChild("State").Changed:Connect(function(enabled) teamCheckEnabled = enabled end)
    fovRadiusSlider:FindFirstChild("State").Changed:Connect(function(value) fovCircleRadius = value; if fovCircleDrawing then fovCircleDrawing.Radius = value end end)
    aimbotDistanceSlider:FindFirstChild("State").Changed:Connect(function(value) aimbotMaxDistance = value end)
    aimbotStrengthSlider:FindFirstChild("State").Changed:Connect(function(value) aimbotStrength = value / 1000 end)
    
    -- [MODIFIED] Connect CharacterAdded for *all* weapon mods
    if LocalPlayer.Character then HandleCharacter(LocalPlayer.Character) end; LocalPlayer.CharacterAdded:Connect(HandleCharacter)
    -- ===================================================================
    -- [END] MOBILE Aimbot/Fov Tab
    -- ===================================================================

    -- ===================================================================
    -- [START] MOBILE Teleport Tab
    -- ===================================================================
    local TeleportTab = Window:AddTab("Teleport");
    local allTeleportLocations = {
        Outside = {
            {Name="Criminal Base", CFrame=CFrame.new(739.997009, 1.1043756, -441.081299, 0.350970954, 4.13434798e-08, 0.936386347, -2.91054416e-08, 1, -3.32430226e-08, -0.936386347, -1.55866022e-08, 0.350970954)},
            {Name="Gas Station", CFrame=CFrame.new(308.1, 5.3, -611.0)},
            {Name="Barn", CFrame=CFrame.new(33.5912628, 10.0311041, 395.669403, 0.21937415, -2.87638127e-08, -0.975640833, 1.04137676e-07, 1, -6.06647443e-09, 0.975640833, -1.00270135e-07, 0.21937415)}
        },
        Prison = {
            {Name="Yard", CFrame=CFrame.new(59.2, 10.1, -136.7)},
            {Name="Security Room", CFrame=CFrame.new(224.2, 23.0, -157.0)},
            {Name="Cafeteria", CFrame=CFrame.new(66.7, 11.2, 31.7)},
            {Name="Checkpoint", CFrame=CFrame.new(-4.5, 22.1, -24.9)},
            {Name="Med Bay", CFrame=CFrame.new(137.3, 11.2, -162.5)},
            {Name="Directors Office", CFrame=CFrame.new(120.523872, 23.0880585, -101.480034, -0.996506214, -7.14903803e-10, -0.0835184902, -1.22781407e-09, 1, 6.08991524e-09, 0.0835184902, 6.17118356e-09, -0.996506214)},
            {Name="Gym", CFrame=CFrame.new(30.7318707, 22.1708984, -1.58649516, -0.534740806, -9.38145206e-09, 0.845016122, 1.5259138e-08, 1, 2.07583444e-08, -0.845016122, 2.39945521e-08, -0.534740806)},
            {Name="Library", CFrame=CFrame.new(-30.1708336, 11.2254019, 3.59955359, 0.973081648, -1.8039751e-08, -0.230460614, 3.96898585e-08, 1, 8.93068943e-08, 0.230460614, -9.60498454e-08, 0.973081648)},
            {Name="Vents", CFrame=CFrame.new(47.2205162, -8.8703413, -63.9462776, 0.053843759, 1.04880968e-07, -0.998549402, 5.04200663e-08, 1, 1.07752079e-07, 0.998549402, -5.61487035e-08, 0.053843759)}
        },
        Blocks = {
            {Name="Max Security", CFrame=CFrame.new(87.0, -8.8, -137.1)},
            {Name="Min/Med Security", CFrame=CFrame.new(-1.5, 11.2, -55.4)},
            {Name="Solitary", CFrame=CFrame.new(144.9, -8.8, -41.6)}
        }
    }
    for categoryName, locations in pairs(allTeleportLocations) do TeleportTab:AddLabel(categoryName); for _, loc in ipairs(locations) do TeleportTab:AddButton(loc.Name).MouseButton1Click:Connect(function() if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then LocalPlayer.Character.HumanoidRootPart.CFrame = loc.CFrame; BlindHubsUiLibrary.CreateNotification("Teleport", "Teleported to " .. loc.Name, 3) end end) end end
    -- ===================================================================
    -- [END] MOBILE Teleport Tab
    -- ===================================================================

    -- ===================================================================
    -- [START] MOBILE Misc Tab (MODIFIED)
    -- ===================================================================
    local MiscTab = Window:AddTab("Misc"); 
    MiscTab:AddLabel("World (Rejoin to restore)"); 
    MiscTab:AddButton("Remove Doors").MouseButton1Click:Connect(function() local doorsFolder = Workspace.Map.Functional:FindFirstChild("Doors"); if doorsFolder then pcall(function() doorsFolder:Destroy() end); BlindHubsUiLibrary.CreateNotification("Misc", "Doors removed.", 3) else BlindHubsUiLibrary.CreateNotification("Error", "Could not find doors folder.", 3) end end); 
    MiscTab:AddButton("Remove Vents").MouseButton1Click:Connect(function() local ventsFolder = Workspace.Map.Functional:FindFirstChild("Vents"); if ventsFolder then pcall(function() ventsFolder:Destroy() end); BlindHubsUiLibrary.CreateNotification("Misc", "Vents removed.", 3) else BlindHubsUiLibrary.CreateNotification("Error", "Could not find vents folder.", 3) end end); 
    MiscTab:AddButton("Remove Spawnkill Barrier").MouseButton1Click:Connect(function() local barriersFolder = Workspace.Map.Functional.Invisible:FindFirstChild("SpawnkillBarriers"); if barriersFolder then pcall(function() barriersFolder:Destroy() end); BlindHubsUiLibrary.CreateNotification("Misc", "Spawnkill barriers removed.", 3) else BlindHubsUiLibrary.CreateNotification("Error", "Could not find spawnkill barriers.", 3) end end); 
    MiscTab:AddButton("Remove Roof Kill").MouseButton1Click:Connect(function() local brickKill = Workspace.Map.Functional.Invisible:FindFirstChild("Brickkill"); if brickKill then pcall(function() brickKill:Destroy() end); BlindHubsUiLibrary.CreateNotification("Misc", "Roof kill part removed.", 3) else BlindHubsUiLibrary.CreateNotification("Error", "Could not find 'Brickkill' part.", 3) end end); 
    
    MiscTab:AddLabel("Automation"); 
    local isAutoPickupEnabled = false; 
    local autoPickupToggle = MiscTab:AddToggle("Auto-Pickup Dropped Tools"); 
    autoPickupToggle:FindFirstChild("State").Changed:Connect(function(enabled) isAutoPickupEnabled = enabled; if not enabled then return end; if type(fireclickdetector) ~= "function" and typeof(fireclickdetector) ~= "function" then BlindHubsUiLibrary.CreateNotification("Error", "'fireclickdetector' not available.", 5); isAutoPickupEnabled = false; autoPickupToggle:FindFirstChild("State").Value = false; return end; task.spawn(function() BlindHubsUiLibrary.CreateNotification("Automation", "Auto-pickup enabled.", 3); while isAutoPickupEnabled do task.wait(); local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart"); local droppedToolsFolder = Workspace:FindFirstChild("DroppedTools"); if hrp and droppedToolsFolder and #droppedToolsFolder:GetChildren() > 0 then local closestTool, minDistance = nil, math.huge; for _, tool in ipairs(droppedToolsFolder:GetChildren()) do local part = tool.PrimaryPart or tool:FindFirstChild("Handle") or tool:FindFirstChild("MainAttach"); if part then local distance = (hrp.Position - part.Position).Magnitude; if distance < minDistance then minDistance, closestTool = distance, tool end end end; if closestTool then local containerPart = closestTool:FindFirstChild("Handle") or closestTool:FindFirstChild("MainAttach"); if containerPart then hrp.CFrame = containerPart.CFrame * CFrame.new(0, 3, 0); task.wait(0.5); local clickDetector = containerPart:FindFirstChildOfClass("ClickDetector"); if clickDetector then fireclickdetector(clickDetector); task.wait(0.5) end end end else task.wait(1) end end end) end); 

    -- [ITEM DROPPER REMOVED FROM HERE]

    MiscTab:AddSeparator() -- Separate from Visuals
    MiscTab:AddLabel("Visuals"); 
    local xrayToggle = MiscTab:AddToggle("X-Ray"); 
    local xrayDescendantConn = nil; 
    local function setXray(enabled) if enabled then for _, v in ipairs(Workspace:GetDescendants()) do if v:IsA("BasePart") and not v:IsDescendantOf(LocalPlayer.Character) then v.LocalTransparencyModifier = 0.75 end end; xrayDescendantConn = Workspace.DescendantAdded:Connect(function(v) if v:IsA("BasePart") and not v:IsDescendantOf(LocalPlayer.Character) then v.LocalTransparencyModifier = 0.75 end end) else if xrayDescendantConn then xrayDescendantConn:Disconnect(); xrayDescendantConn = nil end; for _, v in ipairs(Workspace:GetDescendants()) do if v:IsA("BasePart") then v.LocalTransparencyModifier = 0 end end end end; xrayToggle:FindFirstChild("State").Changed:Connect(setXray); 
    local brightnessToggle = MiscTab:AddToggle("Full Brightness"); 
    local originalLightingProps = nil; 
    brightnessToggle:FindFirstChild("State").Changed:Connect(function(value) if value then if not originalLightingProps then originalLightingProps = {Ambient=Lighting.Ambient, OutdoorAmbient=Lighting.OutdoorAmbient, Brightness=Lighting.Brightness, GlobalShadows=Lighting.GlobalShadows} end; pcall(function() Lighting.Ambient = Color3.fromRGB(180,180,180); Lighting.OutdoorAmbient = Color3.fromRGB(180,180,180); Lighting.Brightness = 1.5; Lighting.GlobalShadows = false end) else if originalLightingProps then pcall(function() Lighting.Ambient = originalLightingProps.Ambient; Lighting.OutdoorAmbient = originalLightingProps.OutdoorAmbient; Lighting.Brightness = originalLightingProps.Brightness; Lighting.GlobalShadows = originalLightingProps.GlobalShadows end) end end end)
    -- ===================================================================
    -- [END] MOBILE Misc Tab
    -- ===================================================================

    -- ===================================================================
    -- [START] MOBILE Settings Tab
    -- ===================================================================
    local SettingsTab = Window:AddTab("Settings"); SettingsTab:AddLabel("Theme"); if SettingsTab.AddDropdown then local themeNames = {}; for name in pairs(Themes) do table.insert(themeNames, name) end; table.sort(themeNames); local themeDropdown = SettingsTab:AddDropdown({Text="Select Theme", Options=themeNames}); themeDropdown:FindFirstChild("State").Changed:Connect(function(newValue) Window:SetTheme(newValue) end) else SettingsTab:AddLabel("Themes not supported by this UI Library.") end; SettingsTab:AddSeparator(); SettingsTab:AddLabel("Visual Settings"); local transparencySlider = SettingsTab:AddSlider({Text="UI Transparency", Min=0, Max=100, Default=55}); transparencySlider:FindFirstChild("State").Changed:Connect(function(newValue) Window.defaultTransparency = 1 - (newValue/100); if Window.MainFrame and not Window.isOpaque then TweenService:Create(Window.MainFrame, TweenInfo.new(0.3), {BackgroundTransparency=Window.defaultTransparency}):Play() end end); local opacityToggle = SettingsTab:AddToggle("Opaque UI"); opacityToggle:FindFirstChild("State").Changed:Connect(function(newValue) Window.isOpaque=newValue; if Window.MainFrame then local goal={BackgroundTransparency=newValue and 0 or Window.defaultTransparency}; TweenService:Create(Window.MainFrame, TweenInfo.new(0.3), goal):Play() end end); local resetButton = SettingsTab:AddButton("Reset Settings"); resetButton.MouseButton1Click:Connect(function() if Window.ResetSettings then Window:ResetSettings(); BlindHubsUiLibrary.CreateNotification("Settings", "All settings have been reset.", 3) end end); SettingsTab:AddSeparator(); local debugInfoGui = nil; local debugInfoConnection = nil; SettingsTab:AddLabel("Utility"); SettingsTab:AddToggle("Debug Info"):FindFirstChild("State").Changed:Connect(function(enabled) if enabled and not debugInfoGui then debugInfoGui = Instance.new("ScreenGui", LocalPlayer.PlayerGui); local frame = Instance.new("Frame", debugInfoGui); frame.Size, frame.BackgroundColor3, frame.BackgroundTransparency = UDim2.fromOffset(150, 60), Color3.new(0, 0, 0), 0.5; local layout = Instance.new("UIListLayout", frame); layout.Padding = UDim.new(0, 5); local fps = Instance.new("TextLabel", frame); fps.Size, fps.Text, fps.TextColor3, fps.BackgroundTransparency = UDim2.new(1, 0, 0, 15), "FPS: 0", Color3.new(1, 1, 1), 1; local ping = Instance.new("TextLabel", frame); ping.Size, ping.Text, ping.TextColor3, fps.BackgroundTransparency = UDim2.new(1, 0, 0, 15), "Ping: 0", Color3.new(1, 1, 1), 1; if debugInfoConnection then debugInfoConnection:Disconnect() end; debugInfoConnection = RunService.Heartbeat:Connect(function() if debugInfoGui and debugInfoGui.Parent then fps.Text = "FPS: " .. math.floor(Workspace:GetRealPhysicsFPS()); ping.Text = "Ping: " .. math.floor(LocalPlayer:GetNetworkPing() * 1000) .. "ms" end end) elseif not enabled and debugInfoGui then if debugInfoConnection then debugInfoConnection:Disconnect(); debugInfoConnection = nil end; pcall(function() debugInfoGui:Destroy() end); debugInfoGui = nil end end); SettingsTab:AddButton("Infinite Yield").MouseButton1Click:Connect(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source", true))() end)
    -- ===================================================================
    -- [END] MOBILE Settings Tab
    -- ===================================================================

    -- Background Loops
    RunService.RenderStepped:Connect(function()
        if PlayerInfoConfig.Enabled then
            local lpHRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if not lpHRP then return end
            for p, cache in pairs(playerInfoCache) do
                local tHRP = p.Character and p.Character:FindFirstChild("HumanoidRootPart")
                local h = p.Character and p.Character:FindFirstChildOfClass("Humanoid")
                if tHRP and h and cache.textLabel and cache.textLabel.Parent then
                    cache.textLabel.Text = string.format("%s\nHealth: %.0f | Dist: %.0f", p.Name, h.Health, (lpHRP.Position - tHRP.Position).magnitude)
                    cache.textLabel.TextColor3 = p.TeamColor.Color
                end
            end
        end
        if highlightESPEnabled then
            for p, h in pairs(highlights) do
                if p and p.Parent and h and h.Parent then
                    h.FillColor, h.OutlineColor = p.TeamColor.Color, p.TeamColor.Color
                end
            end
        end
        if BoxESPEnabled then
            for p, l in pairs(BoxESPObjects) do
                local char, hrp, hum, head = p.Character, p.Character and p.Character:FindFirstChild("HumanoidRootPart"), p.Character and p.Character:FindFirstChildOfClass("Humanoid"), p.Character and p.Character:FindFirstChild("Head")
                if p and p.Parent and hrp and hum and hum.Health > 0 and head then
                    local pos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
                    if onScreen then
                        local headPos = Camera:WorldToViewportPoint(head.Position)
                        local dist = math.clamp((Vector2.new(headPos.X, headPos.Y) - Vector2.new(pos.X, pos.Y)).magnitude, 2, math.huge)
                        local function setPoints(item)
                            item.PointA = Vector2.new(pos.X + dist, pos.Y - dist * 2)
                            item.PointB = Vector2.new(pos.X - dist, pos.Y - dist * 2)
                            item.PointC = Vector2.new(pos.X - dist, pos.Y + dist * 2)
                            item.PointD = Vector2.new(pos.X + dist, pos.Y + dist * 2)
                        end
                        setPoints(l.box); setPoints(l.black)
                        l.box.Color = p.TeamColor.Color
                        BoxVis(true, l)
                    else
                        BoxVis(false, l)
                    end
                else
                    BoxVis(false, l)
                end
            end
        end
        if tracersEnabled then
            for p, t in pairs(tracerDrawings) do
                local hrp = p and p.Character and p.Character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    local pos, on = Camera:WorldToViewportPoint(hrp.Position)
                    if on then
                        t.Color, t.From, t.To, t.Visible = p.TeamColor.Color, Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y), Vector2.new(pos.X, pos.Y), true
                    else
                        t.Visible = false
                    end
                else
                    t.Visible = false
                end
            end
        end
        if fovCircleDrawing and showFovCircle then
            fovCircleDrawing.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
        end
    end)
    
    RunService.Heartbeat:Connect(function()
        -- [SCOPE_FIX] This loop can now see the toggles
        if walkspeedToggle and walkspeedSlider and jumpPowerToggle and jumpPowerSlider then
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
                local h = LocalPlayer.Character.Humanoid
                if walkspeedToggle:FindFirstChild("State").Value then
                    h.WalkSpeed = walkspeedSlider:FindFirstChild("State").Value
                end
                if jumpPowerToggle:FindFirstChild("State").Value then
                    h.JumpPower = jumpPowerSlider:FindFirstChild("State").Value
                end
            end
        end
    end)

    Window:SetTheme(Window.CurrentThemeName or "Orange")
    print("BlindHubOfficial (Mobile) loaded successfully "); print("Welcome to BlindHubOfficial!")
end


-- ===================================================================
-- 5. WELCOME SCREEN (PC/Mobile Selector) - FIXED
-- ===================================================================
function CreateWelcomeScreen()
    local welcomeGui = Instance.new("ScreenGui"); welcomeGui.Name = "WelcomeScreen"; welcomeGui.ResetOnSpawn = false; welcomeGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
    
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.fromOffset(320, 160)
    mainFrame.Position = UDim2.new(0.5, -160, 0.5, -80)
    mainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    mainFrame.BorderSizePixel = 1
    mainFrame.BorderColor3 = Color3.fromRGB(120, 80, 220)
    mainFrame.Parent = welcomeGui
    
    local mainCorner = Instance.new("UICorner", mainFrame)
    mainCorner.CornerRadius = UDim.new(0, 8) 
    
    local titleLabel = Instance.new("TextLabel", mainFrame); titleLabel.Size = UDim2.new(1, 0, 0, 50); titleLabel.BackgroundTransparency = 1; titleLabel.Font = Enum.Font.GothamBold; titleLabel.Text = "Select Your Platform"; titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255); titleLabel.TextSize = 22
    local buttonContainer = Instance.new("Frame", mainFrame); buttonContainer.Size = UDim2.new(1, -20, 0, 80); buttonContainer.Position = UDim2.new(0.5, 0, 0.5, 10); buttonContainer.AnchorPoint = Vector2.new(0.5, 0.5); buttonContainer.BackgroundTransparency = 1
    
    local layout = Instance.new("UIListLayout", buttonContainer)
    layout.FillDirection = Enum.FillDirection.Vertical
    layout.Padding = UDim.new(0, 10)
    layout.HorizontalAlignment = Enum.HorizontalAlignment.Center

    local function createThemedButton(name, text, parent)
        local btn = Instance.new("TextButton"); btn.Name = name; btn.Text = text; btn.Size = UDim2.new(1, 0, 0, 35); btn.BackgroundColor3 = Color3.fromRGB(28, 28, 31); btn.Font = Enum.Font.GothamSemibold; btn.TextColor3 = Color3.fromRGB(220, 220, 220); btn.TextSize = 16; btn.Parent = parent
        
        local btnCorner = Instance.new("UICorner", btn)
        btnCorner.CornerRadius = UDim.new(0, 6) 
        
        local stroke = Instance.new("UIStroke", btn); stroke.Color = Color3.fromRGB(120, 80, 220); stroke.Thickness = 1.5
        return btn
    end

    local pcButton = createThemedButton("PCButton", "PC", buttonContainer)
    local mobileButton = createThemedButton("MobileButton", "Mobile", buttonContainer)

    pcButton.MouseButton1Click:Connect(function()
        pcall(InitializePC_Hub)
        welcomeGui:Destroy()
    end)
    
    mobileButton.MouseButton1Click:Connect(function()
        pcall(InitializeMainHub)
        welcomeGui:Destroy()
    end)

    welcomeGui.Parent = CoreGui
end

-- ===================================================================
-- 6. SCRIPT ENTRY POINT
-- ===================================================================
-- Start the Welcome Screen directly
CreateWelcomeScreen()
